"use strict";(self.webpackChunkreact_frontend_init=self.webpackChunkreact_frontend_init||[]).push([[4570],{16366:function(xn,tn,p){p.r(tn),p.d(tn,{default:function(){return fi}});var In=p(84136),A=p.n(In),bn=p(64581),ee=p.n(bn),wn=p(94127),pe=p.n(wn),Pn=p(57566),f=p.n(Pn),va=p(52487),B=p.n(va),Nn=p(90785),v=p.n(Nn),ue=p(77268),l=p(67294),Q=p(68872),z=p(83062),I=p(83622),he=p(74330),Ce=p(55102),fa=p(25820),pa=p(75750),te={emoticonPicker:"emoticonPicker___VaiVF",searchInput:"searchInput___dwsSa",sectionTitle:"sectionTitle___jXsX3",emoticonList:"emoticonList___l7PVd",loading:"loading___lv2ux",emoticonItemWrapper:"emoticonItemWrapper___mMHRC",favoriteButton:"favoriteButton___yXa6p",emoticonItem:"emoticonItem___uRVo4",previewContainer:"previewContainer___HFwqx",previewImage:"previewImage___dVKRq"},re=p(82257);function _t(M,F){return Tn.apply(this,arguments)}function Tn(){return Tn=B()(f()().mark(function M(F,D){return f()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,re.request)("/api/emoticon_favour/add",A()({method:"POST",headers:{"Content-Type":"application/json"},data:F},D||{})));case 1:case"end":return g.stop()}},M)})),Tn.apply(this,arguments)}function St(M,F){return Fn.apply(this,arguments)}function Fn(){return Fn=B()(f()().mark(function M(F,D){return f()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,re.request)("/api/emoticon_favour/delete",A()({method:"POST",headers:{"Content-Type":"application/json"},data:F},D||{})));case 1:case"end":return g.stop()}},M)})),Fn.apply(this,arguments)}function jt(M,F){return En.apply(this,arguments)}function En(){return En=B()(f()().mark(function M(F,D){return f()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,re.request)("/api/emoticon_favour/list/page",A()({method:"POST",headers:{"Content-Type":"application/json"},data:F},D||{})));case 1:case"end":return g.stop()}},M)})),En.apply(this,arguments)}var ws=p(84169),Ps=p.n(ws),Ns=p(29957),Ts=p.n(Ns),Fs=p(75204),Za=p.n(Fs),Es=function(){function M(){Ps()(this,M),Za()(this,"events",{})}return Ts()(M,[{key:"on",value:function(D,L){this.events[D]||(this.events[D]=[]),this.events[D].push(L)}},{key:"off",value:function(D,L){this.events[D]&&(this.events[D]=this.events[D].filter(function(g){return g!==L}))}},{key:"emit",value:function(D){for(var L=arguments.length,g=new Array(L>1?L-1:0),xe=1;xe<L;xe++)g[xe-1]=arguments[xe];this.events[D]&&this.events[D].forEach(function(ge){return ge.apply(void 0,g)})}}]),M}(),Ms=new Es,ha=Ms,Ds=p(56840),Ct=p.n(Ds);function As(M,F){return Mn.apply(this,arguments)}function Mn(){return Mn=B()(f()().mark(function M(F,D){return f()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,re.request)("/api/api/web/parse",A()({method:"GET",params:A()({},F)},D||{})));case 1:case"end":return g.stop()}},M)})),Mn.apply(this,arguments)}var Bs=p(34804),na=p(97245),Rs=p(69753),Zs=p(99559),Ls=p(29158),Us=p(51180),La=p(4393),Ws=p(22424),Mo=p(52520),Dn=p(556),An=p(93680),Bn=p(48592),Rn=p(4958),E={messageContent:"messageContent___QDsxD",messageImage:"messageImage___L8FDo",token:"token___lIQb4",comment:"comment___xwEkT",prolog:"prolog___l_OdM",doctype:"doctype___VvxKq",cdata:"cdata___wSAtJ",punctuation:"punctuation___shnbA",property:"property___MN7rR",tag:"tag___Cq6BQ",boolean:"boolean___aESYl",number:"number___Beu8g",constant:"constant___uFwGC",symbol:"symbol___FDQMO",deleted:"deleted___qeUn0",selector:"selector___mq8es",string:"string___GzgHl",char:"char___L3KuK",builtin:"builtin___ZBFOs",operator:"operator___j_QxS",entity:"entity___fQknN",url:"url___Aq_wx","language-css":"language-css___MJU0k",style:"style___wg3ay",keyword:"keyword___t33sZ",function:"function___PHIPs","attr-name":"attr-name___Yc1WI",variable:"variable___y_EQi",linkCard:"linkCard___kZQHn",linkContent:"linkContent___StS8r",linkIcon:"linkIcon___C5bTz",linkInfo:"linkInfo___pGJPi",videoTitle:"videoTitle___yxq0D",videoDescription:"videoDescription___mcpmO",linkText:"linkText___OTvlT","anticon-bilibili":"anticon-bilibili___A3ZwX","anticon-video-camera":"anticon-video-camera___r7SSr","anticon-link":"anticon-link___WpEO4",bilibiliCard:"bilibiliCard___Qkglt",bilibiliContent:"bilibiliContent___eSLLZ",bilibiliPreview:"bilibiliPreview___Nywwa",douyinCard:"douyinCard___ECBeD",douyinContent:"douyinContent___DhByH",fileContainer:"fileContainer___KsRWh",fileCard:"fileCard___HgmQz",fileInfo:"fileInfo___gOSnJ",fileIcon:"fileIcon___C8Yid",fileName:"fileName___YU5s9",downloadButton:"downloadButton___uDFsM",anticon:"anticon___Thub5",imageContainer:"imageContainer___JmzJP",imageControlButtons:"imageControlButtons___Snd_m",favoriteButton:"favoriteButton___p9qyM",collapseButton:"collapseButton___a8oj3",imageText:"imageText___EKoJ2",imageControls:"imageControls___hOow6",hideButton:"hideButton___F23Kr"},e=p(85893),Os=["node"],Hs=["node"],ga="emoticon_favorite_changed",$s="https://lf1-cdn-tos.bytegoofy.com/goofy/ies/douyin_web/public/favicon.ico",zs="https://www.codefather.cn/favicon.ico",Do="favorite_emoticons",Vs=function(F){var D=F.content,L=F.onImageLoad,g=(0,re.useModel)("@@initialState"),xe=g.initialState,ge=xe||{},Pe=ge.currentUser,Ca=(0,l.useState)({}),Ne=v()(Ca,2),J=Ne[0],Wa=Ne[1],ya=(0,l.useState)({}),ka=v()(ya,2),se=ka[0],Te=ka[1],_e=(0,l.useState)([]),Ge=v()(_e,2),Ke=Ge[0],xa=Ge[1],Qe=(0,l.useState)(!1),ta=v()(Qe,2),ra=ta[0],Ia=ta[1],Ie=(0,l.useRef)(!1),Se=new RegExp("(https?://[^\\s]+)","g"),oe=new RegExp("\\[img\\](.*?)\\[/img\\]","g"),Oa=new RegExp("\\[file\\](.*?)\\[/file\\]","g"),ba=(0,l.useState)(new Set),Je=v()(ba,2),c=Je[0],wa=Je[1],Fe=function(){var W=B()(f()().mark(function d(){var y;return f()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:if(Pe!=null&&Pe.id){Z.next=3;break}return xa([]),Z.abrupt("return");case 3:if(!Ie.current){Z.next=5;break}return Z.abrupt("return");case 5:return Ia(!0),Z.prev=6,Z.next=9,jt({current:1,pageSize:100});case 9:y=Z.sent,y.code===0&&y.data&&(xa(y.data.records||[]),Ie.current=!0),Z.next=16;break;case 13:Z.prev=13,Z.t0=Z.catch(6),console.error("\u83B7\u53D6\u6536\u85CF\u8868\u60C5\u5305\u5931\u8D25:",Z.t0);case 16:return Z.prev=16,Ia(!1),Z.finish(16);case 19:case"end":return Z.stop()}},d,null,[[6,13,16,19]])}));return function(){return W.apply(this,arguments)}}(),C=function(){var W=B()(f()().mark(function d(y){var k;return f()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.prev=0,w.next=3,_t(y);case 3:k=w.sent,k.code===0?(Q.ZP.success("\u6536\u85CF\u6210\u529F"),Fe(),ha.emit(ga,"add",y)):Q.ZP.error("\u6536\u85CF\u5931\u8D25"),w.next=11;break;case 7:w.prev=7,w.t0=w.catch(0),console.error("\u6536\u85CF\u5931\u8D25:",w.t0),Q.ZP.error("\u6536\u85CF\u5931\u8D25");case 11:case"end":return w.stop()}},d,null,[[0,7]])}));return function(y){return W.apply(this,arguments)}}(),Pa=function(){var W=B()(f()().mark(function d(y){var k;return f()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.prev=0,w.next=3,St({id:y});case 3:k=w.sent,k.code===0?(Q.ZP.success("\u53D6\u6D88\u6536\u85CF\u6210\u529F"),Fe(),ha.emit(ga,"remove",y)):Q.ZP.error("\u53D6\u6D88\u6536\u85CF\u5931\u8D25"),w.next=11;break;case 7:w.prev=7,w.t0=w.catch(0),console.error("\u53D6\u6D88\u6536\u85CF\u5931\u8D25:",w.t0),Q.ZP.error("\u53D6\u6D88\u6536\u85CF\u5931\u8D25");case 11:case"end":return w.stop()}},d,null,[[0,7]])}));return function(y){return W.apply(this,arguments)}}(),Na=function(d){return Ke.some(function(y){return y.emoticonSrc===d})},sa=function(d){var y=Ke.find(function(k){return k.emoticonSrc===d});y?Pa(y.id):C(d)};(0,l.useEffect)(function(){var W=function(){Ie.current=!1,Fe()};return ha.on(ga,W),function(){ha.off(ga,W)}},[Pe==null?void 0:Pe.id]);var ie=function(d){var y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:20;return d.length<=y?d:d.slice(0,y)+"..."},be=function(){var W=B()(f()().mark(function d(y){var k;return f()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return Te(function(P){return A()(A()({},P),{},Za()({},y,!0))}),w.prev=1,w.next=4,As({url:y});case 4:k=w.sent,k.code===0&&k.data&&Wa(function(P){var j,_,N;return A()(A()({},P),{},Za()({},y,{title:((j=k.data)===null||j===void 0?void 0:j.title)||"\u672A\u77E5\u6807\u9898",description:((_=k.data)===null||_===void 0?void 0:_.description)||"\u6682\u65E0\u63CF\u8FF0",favicon:(N=k.data)===null||N===void 0?void 0:N.favicon}))}),w.next=12;break;case 8:w.prev=8,w.t0=w.catch(1),console.error("\u83B7\u53D6\u7F51\u9875\u4FE1\u606F\u5931\u8D25:",w.t0),Wa(function(P){return A()(A()({},P),{},Za()({},y,{title:"\u672A\u77E5\u7F51\u9875",description:"\u83B7\u53D6\u7F51\u9875\u4FE1\u606F\u5931\u8D25",favicon:void 0}))});case 12:return w.prev=12,Te(function(P){return A()(A()({},P),{},Za()({},y,!1))}),w.finish(12);case 15:case"end":return w.stop()}},d,null,[[1,8,12,15]])}));return function(y){return W.apply(this,arguments)}}(),Ha=function(d){var y=d.split("/").pop()||"\u672A\u77E5\u6587\u4EF6",k=document.createElement("a");k.href=d,k.download=y,document.body.appendChild(k),k.click(),document.body.removeChild(k)},ia=(0,l.useState)("show"),qe=v()(ia,2),la=qe[0],Ee=qe[1],Xe=(0,l.useState)(new Set),Me=v()(Xe,2),Ta=Me[0],oa=Me[1];(0,l.useEffect)(function(){var W=localStorage.getItem("siteConfig");if(W){var d=JSON.parse(W),y=d.imageDisplayMode;Ee(y||"show")}},[]);var Fa=function(d,y){var k=la==="hide"&&!Ta.has(d),Z=c.has(d);return k?(0,e.jsx)("div",{className:E.imageText,onClick:function(){oa(function(P){return new Set([].concat(ee()(P),[d]))})},children:"\u56FE\u7247\uFF08\u70B9\u51FB\u663E\u793A\uFF09"},y):Z?(0,e.jsx)("div",{className:E.imageText,onClick:function(){wa(function(P){var j=new Set(P);return j.delete(d),j})},children:"\u56FE\u7247\u5DF2\u6298\u53E0\uFF08\u70B9\u51FB\u5C55\u5F00\uFF09"},y):(0,e.jsxs)("div",{className:E.imageContainer,children:[(0,e.jsx)(Us.Z,{src:d,alt:"\u56FE\u7247",className:E.messageImage,preview:{mask:!1},onLoad:function(){L==null||L()}}),(0,e.jsxs)("div",{className:E.imageControlButtons,children:[la==="hide"&&(0,e.jsx)(I.ZP,{type:"text",size:"small",className:E.hideButton,onClick:function(){oa(function(P){var j=new Set(P);return j.delete(d),j})},children:"\u9690\u85CF"}),(0,e.jsx)(I.ZP,{type:"text",size:"small",icon:(0,e.jsx)(Bs.Z,{}),className:E.collapseButton,onClick:function(P){P.stopPropagation(),wa(function(j){var _=new Set(j);return _.add(d),_})},title:"\u6298\u53E0\u56FE\u7247"}),(0,e.jsx)(I.ZP,{type:"text",size:"small",icon:Na(d)?(0,e.jsx)(fa.Z,{style:{color:"#ffd700"}}):(0,e.jsx)(pa.Z,{}),className:E.favoriteButton,onClick:function(P){P.stopPropagation(),sa(d)},title:Na(d)?"\u53D6\u6D88\u6536\u85CF":"\u6536\u85CF\u56FE\u7247"})]})]},y)},ua=function(d,y){var k,Z=d.split("/").pop()||"\u672A\u77E5\u6587\u4EF6",w=((k=Z.split(".").pop())===null||k===void 0?void 0:k.toLowerCase())||"",P=function(_){var N={pdf:(0,e.jsx)(na.Z,{style:{color:"#ff4d4f"}}),doc:(0,e.jsx)(na.Z,{style:{color:"#1890ff"}}),docx:(0,e.jsx)(na.Z,{style:{color:"#1890ff"}}),xls:(0,e.jsx)(na.Z,{style:{color:"#52c41a"}}),xlsx:(0,e.jsx)(na.Z,{style:{color:"#52c41a"}}),txt:(0,e.jsx)(na.Z,{style:{color:"#722ed1"}})};return N[_]||(0,e.jsx)(na.Z,{style:{color:"#1890ff"}})};return(0,e.jsx)("div",{className:E.fileContainer,children:(0,e.jsxs)(La.Z,{className:E.fileCard,size:"small",children:[(0,e.jsxs)("div",{className:E.fileInfo,children:[(0,e.jsx)("span",{className:E.fileIcon,children:P(w)}),(0,e.jsx)("span",{className:E.fileName,title:Z,children:Z})]}),(0,e.jsxs)(I.ZP,{type:"link",className:E.downloadButton,onClick:function(){return Ha(d)},children:[(0,e.jsx)(Rs.Z,{})," \u4E0B\u8F7D\u6587\u4EF6"]})]})},y)},ye=function(d,y){var k;return d.includes("bilibili.com")?(!J[d]&&!se[d]&&be(d),(0,e.jsx)(La.Z,{className:E.linkCard,size:"small",hoverable:!0,children:(0,e.jsxs)("div",{className:E.linkContent,children:[(0,e.jsx)(Zs.Z,{className:E.linkIcon}),(0,e.jsx)("div",{className:E.linkInfo,children:J[d]?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:E.videoTitle,children:J[d].title}),J[d].description&&(0,e.jsx)("div",{className:E.videoDescription,children:ie(J[d].description,50)}),(0,e.jsx)("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:E.linkText,children:ie(d,30)})]}):(0,e.jsx)("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:E.linkText,children:d})})]})},y)):d.includes("douyin.com")?(!J[d]&&!se[d]&&be(d),(0,e.jsx)(La.Z,{className:E.linkCard,size:"small",hoverable:!0,children:(0,e.jsxs)("div",{className:E.linkContent,children:[(0,e.jsx)("img",{src:$s,alt:"\u6296\u97F3",className:E.linkIcon,style:{width:"16px",height:"16px"}}),(0,e.jsx)("div",{className:E.linkInfo,children:J[d]?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:E.videoTitle,children:J[d].title}),J[d].description&&(0,e.jsx)("div",{className:E.videoDescription,children:ie(J[d].description,50)}),(0,e.jsx)("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:E.linkText,children:ie(d,30)})]}):(0,e.jsx)("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:E.linkText,children:d})})]})},y)):d.includes("codefather.cn/post/")?(!J[d]&&!se[d]&&be(d),(0,e.jsx)(La.Z,{className:E.linkCard,size:"small",hoverable:!0,children:(0,e.jsxs)("div",{className:E.linkContent,children:[(0,e.jsx)("img",{src:zs,alt:"\u7F16\u7A0B\u5BFC\u822A",className:E.linkIcon,style:{width:"16px",height:"16px"}}),(0,e.jsx)("div",{className:E.linkInfo,children:J[d]?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:E.videoTitle,children:J[d].title}),J[d].description&&(0,e.jsx)("div",{className:E.videoDescription,children:ie(J[d].description,50)}),(0,e.jsx)("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:E.linkText,children:ie(d,30)})]}):(0,e.jsx)("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:E.linkText,children:ie(d,30)})})]})},y)):(!J[d]&&!se[d]&&be(d),(0,e.jsx)(La.Z,{className:E.linkCard,size:"small",hoverable:!0,children:(0,e.jsxs)("div",{className:E.linkContent,children:[(k=J[d])!==null&&k!==void 0&&k.favicon?(0,e.jsx)("img",{src:J[d].favicon,alt:"\u7F51\u7AD9\u56FE\u6807",className:E.linkIcon,style:{width:"16px",height:"16px"}}):(0,e.jsx)(Ls.Z,{className:E.linkIcon}),(0,e.jsx)("div",{className:E.linkInfo,children:J[d]?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:E.videoTitle,children:J[d].title}),J[d].description&&(0,e.jsx)("div",{className:E.videoDescription,children:ie(J[d].description,50)}),(0,e.jsx)("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:E.linkText,children:ie(d,30)})]}):(0,e.jsx)("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:E.linkText,children:d})})]})},y))},ce=function(d){return Ws.Z.sanitize(d,{ALLOWED_TAGS:["p","br","strong","em","code","pre","blockquote","ul","ol","li","h1","h2","h3","h4","h5","h6","a","img","table","thead","tbody","tr","th","td"],ALLOWED_ATTR:["href","src","alt","title","target","rel","class"],FORBID_TAGS:["iframe","script","style","form","input","button","textarea","select","option","object","embed","param","meta","link"],FORBID_ATTR:["onerror","onload","onclick","onmouseover","onmouseout","onmouseenter","onmouseleave","onblur","onfocus","onchange","onsubmit","onreset","onkeydown","onkeypress","onkeyup","onmousedown","onmouseup","onmousemove","onmousewheel","onwheel","onresize","onscroll","onabort","oncanplay","oncanplaythrough","oncuechange","ondurationchange","onemptied","onended","onerror","onloadeddata","onloadedmetadata","onloadstart","onpause","onplay","onplaying","onprogress","onratechange","onseeked","onseeking","onstalled","onsuspend","ontimeupdate","onvolumechange","onwaiting","onbeforecopy","onbeforecut","onbeforepaste","oncopy","oncut","onpaste","onselect","onselectionchange","onselectstart","oncontextmenu","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","onblur","onfocus","onfocusin","onfocusout","onkeydown","onkeypress","onkeyup","onclick","ondblclick","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onwheel","onresize","onscroll","onabort","oncanplay","oncanplaythrough","oncuechange","ondurationchange","onemptied","onended","onerror","onloadeddata","onloadedmetadata","onloadstart","onpause","onplay","onplaying","onprogress","onratechange","onseeked","onseeking","onstalled","onsuspend","ontimeupdate","onvolumechange","onwaiting","onbeforecopy","onbeforecut","onbeforepaste","oncopy","oncut","onpaste","onselect","onselectionchange","onselectstart","oncontextmenu","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop"]})},$a=function(d){var y=/<iframe[^>]*>.*?<\/iframe>/gi;return y.test(d)},De={a:function(d){var y=d.node,k=Ct()(d,Os),Z=k.href||"";return Z.match(Se)?ye(Z,"markdown-url-".concat(Date.now())):(0,e.jsx)("a",A()(A()({},k),{},{target:"_blank",rel:"noopener noreferrer"}))},img:function(d){var y=d.node,k=Ct()(d,Hs),Z=k.src||"";return Z.match(/^https?:\/\//)?Fa(Z,"img-".concat(Date.now())):(0,e.jsx)("img",A()(A()({},k),{},{alt:k.alt||"\u56FE\u7247"}))},iframe:function(){return null},script:function(){return null},style:function(){return null}},za=function(){if($a(D))return(0,e.jsx)("div",{className:E.messageContent,children:"\u6D88\u606F\u5305\u542B\u4E0D\u5B89\u5168\u7684 iframe \u6807\u7B7E\uFF0C\u5DF2\u88AB\u8FC7\u6EE4"});for(var d=[],y=0,k;(k=oe.exec(D))!==null;){if(k.index>y){var Z=D.slice(y,k.index),w=Z.split(Se);w.forEach(function(Y,ve){Y.match(Se)?d.push(ye(Y,"url-".concat(k.index,"-").concat(ve))):Y&&d.push((0,e.jsx)(Dn.UG,{remarkPlugins:[Rn.Z],rehypePlugins:[Bn.Z,An.ZP],components:De,children:ce(Y)},"markdown-".concat(k.index,"-").concat(ve)))})}d.push(Fa(k[1],"img-".concat(k.index))),y=k.index+k[0].length}for(var P=D.slice(y),j=0,_;(_=Oa.exec(P))!==null;){if(_.index>j){var N=P.slice(j,_.index),ne=N.split(Se);ne.forEach(function(Y,ve){Y.match(Se)?d.push(ye(Y,"url-file-".concat(_.index,"-").concat(ve))):Y&&d.push((0,e.jsx)(Dn.UG,{remarkPlugins:[Rn.Z],rehypePlugins:[Bn.Z,An.ZP],components:De,children:ce(Y)},"markdown-file-".concat(_.index,"-").concat(ve)))})}d.push(ua(_[1],"file-".concat(_.index))),j=_.index+_[0].length}if(j<P.length){var T=P.slice(j),de=T.split(Se);de.forEach(function(Y,ve){Y.match(Se)?d.push(ye(Y,"url-final-".concat(ve))):Y&&d.push((0,e.jsx)(Dn.UG,{remarkPlugins:[Rn.Z],rehypePlugins:[Bn.Z,An.ZP],components:De,children:ce(Y)},"markdown-final-".concat(ve)))})}return d};return(0,e.jsx)("div",{className:E.messageContent,children:za()})},yt=Vs,kt=12,Gs=function(F){var D=F.onSelect,L=(0,re.useModel)("@@initialState"),g=L.initialState,xe=g||{},ge=xe.currentUser,Pe=(0,l.useState)(""),Ca=v()(Pe,2),Ne=Ca[0],J=Ca[1],Wa=(0,l.useState)([]),ya=v()(Wa,2),ka=ya[0],se=ya[1],Te=(0,l.useState)(!1),_e=v()(Te,2),Ge=_e[0],Ke=_e[1],xa=(0,l.useState)(1),Qe=v()(xa,2),ta=Qe[0],ra=Qe[1],Ia=(0,l.useState)(!0),Ie=v()(Ia,2),Se=Ie[0],oe=Ie[1],Oa=(0,l.useState)([]),ba=v()(Oa,2),Je=ba[0],c=ba[1],wa=(0,l.useState)(!1),Fe=v()(wa,2),C=Fe[0],Pa=Fe[1],Na=(0,l.useState)(1),sa=v()(Na,2),ie=sa[0],be=sa[1],Ha=(0,l.useState)(!0),ia=v()(Ha,2),qe=ia[0],la=ia[1],Ee=(0,l.useRef)(null),Xe=(0,l.useRef)(null),Me=(0,l.useRef)(!1),Ta=(0,l.useState)(!1),oa=v()(Ta,2),Fa=oa[0],ua=oa[1],ye=(0,l.useRef)(),ce=function(){var P=B()(f()().mark(function j(){var _,N,ne,T,de,Y=arguments;return f()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(_=Y.length>0&&Y[0]!==void 0?Y[0]:1,ge!=null&&ge.id){X.next=4;break}return c([]),X.abrupt("return");case 4:if(!(_===1&&Me.current)){X.next=6;break}return X.abrupt("return");case 6:return Pa(!0),X.prev=7,X.next=10,jt({current:_,pageSize:kt});case 10:N=X.sent,N.code===0&&N.data?(ne=N.data,T=ne.records,de=ne.total,_===1?(c(T||[]),Me.current=!0):c(function(Ye){return[].concat(ee()(Ye),ee()(T||[]))}),!T||T.length===0||((T==null?void 0:T.length)||0)*_>=(de||0)?la(!1):la(((T==null?void 0:T.length)||0)*_<(de||0)),be(_)):Q.ZP.error("\u83B7\u53D6\u6536\u85CF\u8868\u60C5\u5305\u5931\u8D25"),X.next=18;break;case 14:X.prev=14,X.t0=X.catch(7),console.error("\u83B7\u53D6\u6536\u85CF\u8868\u60C5\u5305\u5931\u8D25:",X.t0),Q.ZP.error("\u83B7\u53D6\u6536\u85CF\u8868\u60C5\u5305\u5931\u8D25");case 18:return X.prev=18,Pa(!1),X.finish(18);case 21:case"end":return X.stop()}},j,null,[[7,14,18,21]])}));return function(){return P.apply(this,arguments)}}(),$a=function(){var P=B()(f()().mark(function j(_){var N;return f()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.prev=0,T.next=3,_t(_);case 3:N=T.sent,N.code===0?(Q.ZP.success("\u6536\u85CF\u6210\u529F"),ce(1)):Q.ZP.error("\u6536\u85CF\u5931\u8D25"),T.next=11;break;case 7:T.prev=7,T.t0=T.catch(0),console.error("\u6536\u85CF\u5931\u8D25:",T.t0),Q.ZP.error("\u6536\u85CF\u5931\u8D25");case 11:case"end":return T.stop()}},j,null,[[0,7]])}));return function(_){return P.apply(this,arguments)}}(),De=function(){var P=B()(f()().mark(function j(_){var N;return f()().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.prev=0,T.next=3,St({id:_});case 3:N=T.sent,N.code===0?(Q.ZP.success("\u53D6\u6D88\u6536\u85CF\u6210\u529F"),ce(1)):Q.ZP.error("\u53D6\u6D88\u6536\u85CF\u5931\u8D25"),T.next=11;break;case 7:T.prev=7,T.t0=T.catch(0),console.error("\u53D6\u6D88\u6536\u85CF\u5931\u8D25:",T.t0),Q.ZP.error("\u53D6\u6D88\u6536\u85CF\u5931\u8D25");case 11:case"end":return T.stop()}},j,null,[[0,7]])}));return function(_){return P.apply(this,arguments)}}(),za=function(j){return Je.some(function(_){return _.emoticonSrc===j})},W=function(j){var _=Je.find(function(N){return N.emoticonSrc===j});_?De(_.id):$a(j)},d=function(){var P=B()(f()().mark(function j(_){var N,ne,T,de,Y,ve,X,Ye,Va=arguments;return f()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:if(N=Va.length>1&&Va[1]!==void 0?Va[1]:1,_.trim()){q.next=4;break}return se([]),q.abrupt("return");case 4:return Ke(!0),ua(!0),q.prev=6,q.next=9,fetch("https://cn.apihz.cn/api/img/apihzbqbbaidu.php?id=10004660&key=7c3485d99f196b59266266835e3982a9&limit=10&page=".concat(N,"&words=").concat(encodeURIComponent(_)));case 9:return ne=q.sent,q.next=12,ne.json();case 12:if(T=q.sent,!(T.code===200&&T.res&&T.res.length>0)){q.next=20;break}de=T.res.map(function(Ae,ln){return{thumbSrc:Ae,idx:ln,source:Ae,isError:!1}}),se(N===1?de:function(Ae){return[].concat(ee()(Ae),ee()(de))}),oe(N<parseInt(T.maxpage)),ra(N),q.next=27;break;case 20:return q.next=22,fetch("https://moyuapi.codebug.icu/sogou-api/napi/wap/emoji/searchlist?keyword=".concat(encodeURIComponent(_),"&spver=&rcer=&tag=0&routeName=emosearch"));case 22:return ve=q.sent,q.next=25,ve.json();case 25:X=q.sent,X.status===0&&(Y=X.data)!==null&&Y!==void 0&&Y.emotions?(Ye=X.data.emotions.map(function(Ae){return A()(A()({},Ae),{},{isError:!1})}),se(N===1?Ye:function(Ae){return[].concat(ee()(Ae),ee()(Ye))}),oe(Ye.length===kt),ra(N)):(se([]),oe(!1));case 27:q.next=34;break;case 29:q.prev=29,q.t0=q.catch(6),console.error("\u641C\u7D22\u8868\u60C5\u5305\u5931\u8D25:",q.t0),se([]),oe(!1);case 34:return q.prev=34,Ke(!1),ua(!1),q.finish(34);case 38:case"end":return q.stop()}},j,null,[[6,29,34,38]])}));return function(_){return P.apply(this,arguments)}}(),y=function(j){if(J(j),ye.current&&clearTimeout(ye.current),!j.trim()){se([]);return}ye.current=setTimeout(function(){ra(1),oe(!0),se([]),d(j,1)},800)};(0,l.useEffect)(function(){ce(1);var P=function(){Me.current=!1,ce(1)};return ha.on(ga,P),function(){ha.off(ga,P)}},[ge==null?void 0:ge.id]),(0,l.useEffect)(function(){var P=function(){if(!(!Ee.current||Ge||!Se)){var N=Ee.current,ne=N.scrollTop,T=N.scrollHeight,de=N.clientHeight;T-ne-de<50&&d(Ne,ta+1)}},j=Ee.current;if(j)return j.addEventListener("scroll",P),function(){return j.removeEventListener("scroll",P)}},[Ge,Se,ta,Ne]),(0,l.useEffect)(function(){var P=function(){if(!(!Xe.current||C||!qe)){var N=Xe.current,ne=N.scrollTop,T=N.scrollHeight,de=N.clientHeight;T-ne-de<50&&ce(ie+1)}},j=Xe.current;if(j)return j.addEventListener("scroll",P),function(){return j.removeEventListener("scroll",P)}},[C,qe,ie]);var k=function(j){se(function(_){return _.map(function(N){return N.source===j.source?A()(A()({},N),{},{isError:!0}):N})})},Z=function(j){return j.map(function(_){return(0,e.jsxs)("div",{className:te.emoticonItemWrapper,children:[(0,e.jsx)(z.Z,{title:(0,e.jsx)("div",{className:te.previewContainer,children:(0,e.jsx)("img",{src:_.emoticonSrc,alt:"preview",className:te.previewImage})}),placement:"right",overlayClassName:te.tooltipOverlay,mouseEnterDelay:.5,children:(0,e.jsx)("img",{src:_.emoticonSrc,alt:"emoticon",className:te.emoticonItem,onClick:function(){return D(_.emoticonSrc)}})}),(0,e.jsx)(I.ZP,{type:"text",size:"small",icon:(0,e.jsx)(fa.Z,{}),className:te.favoriteButton,onClick:function(ne){ne.stopPropagation(),De(_.id)}})]},_.id)})},w=function(j){return(0,e.jsxs)("div",{ref:Ee,className:te.emoticonList,children:[j.filter(function(_){return!_.isError}).map(function(_){return(0,e.jsxs)("div",{className:te.emoticonItemWrapper,children:[(0,e.jsx)(z.Z,{title:(0,e.jsx)("div",{className:te.previewContainer,children:(0,e.jsx)("img",{src:_.thumbSrc,alt:"preview",className:te.previewImage})}),placement:"right",overlayClassName:te.tooltipOverlay,mouseEnterDelay:.5,children:(0,e.jsx)("img",{src:_.thumbSrc,alt:"emoticon",className:te.emoticonItem,onClick:function(){return D(_.thumbSrc)},onError:function(){return k(_)}})}),(0,e.jsx)(I.ZP,{type:"text",size:"small",icon:za(_.thumbSrc)?(0,e.jsx)(fa.Z,{style:{color:"#fadb14"}}):(0,e.jsx)(pa.Z,{}),className:te.favoriteButton,onClick:function(ne){ne.stopPropagation(),W(_.thumbSrc)}})]},_.source)}),Ge&&(0,e.jsx)("div",{className:te.loading,children:(0,e.jsx)(he.Z,{})})]})};return(0,l.useEffect)(function(){return function(){ye.current&&clearTimeout(ye.current)}},[]),(0,e.jsxs)("div",{className:te.emoticonPicker,children:[(0,e.jsx)(Ce.Z.Search,{placeholder:"\u641C\u7D22\u8868\u60C5\u5305...",value:Ne,onChange:function(j){return y(j.target.value)},onSearch:function(j){return y(j)},className:te.searchInput,loading:Fa,allowClear:!0}),Ne.trim()?w(ka):(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{ref:Xe,className:te.emoticonList,children:[Z(Je),C&&(0,e.jsx)("div",{className:te.loading,children:(0,e.jsx)(he.Z,{})})]})})]})},Ks=Gs;function Qs(M,F){return Zn.apply(this,arguments)}function Zn(){return Zn=B()(f()().mark(function M(F,D){return f()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,re.request)("/api/chat/message/page/vo",A()({method:"POST",headers:{"Content-Type":"application/json"},data:F},D||{})));case 1:case"end":return g.stop()}},M)})),Zn.apply(this,arguments)}function Js(M){return Ln.apply(this,arguments)}function Ln(){return Ln=B()(f()().mark(function M(F){return f()().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return L.abrupt("return",(0,re.request)("/api/chat/online/user",A()({method:"GET"},F||{})));case 1:case"end":return L.stop()}},M)})),Ln.apply(this,arguments)}function Ao(M,F){return Un.apply(this,arguments)}function Un(){return Un=_asyncToGenerator(_regeneratorRuntime().mark(function M(F,D){return _regeneratorRuntime().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",request("/api/chat/stream",_objectSpread({method:"GET",params:_objectSpread({},F)},D||{})));case 1:case"end":return g.stop()}},M)})),Un.apply(this,arguments)}var xt=p(83596);function qs(M,F){return Wn.apply(this,arguments)}function Wn(){return Wn=B()(f()().mark(function M(F,D){return f()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,re.request)("/api/redpacket/create",A()({method:"POST",headers:{"Content-Type":"application/json"},data:F},D||{})));case 1:case"end":return g.stop()}},M)})),Wn.apply(this,arguments)}function Xs(M,F){return On.apply(this,arguments)}function On(){return On=B()(f()().mark(function M(F,D){return f()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,re.request)("/api/redpacket/detail",A()({method:"GET",params:A()({},F)},D||{})));case 1:case"end":return g.stop()}},M)})),On.apply(this,arguments)}function Ys(M,F){return Hn.apply(this,arguments)}function Hn(){return Hn=B()(f()().mark(function M(F,D){return f()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,re.request)("/api/redpacket/grab",A()({method:"POST",params:A()({},F)},D||{})));case 1:case"end":return g.stop()}},M)})),Hn.apply(this,arguments)}function ei(M,F){return $n.apply(this,arguments)}function $n(){return $n=B()(f()().mark(function M(F,D){return f()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,re.request)("/api/redpacket/records",A()({method:"GET",params:A()({},F)},D||{})));case 1:case"end":return g.stop()}},M)})),$n.apply(this,arguments)}function ai(M,F){return zn.apply(this,arguments)}function zn(){return zn=B()(f()().mark(function M(F,D){return f()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,re.request)("/api/user/mute/add",A()({method:"POST",headers:{"Content-Type":"application/json"},data:F},D||{})));case 1:case"end":return g.stop()}},M)})),zn.apply(this,arguments)}function ni(M,F){return Vn.apply(this,arguments)}function Vn(){return Vn=B()(f()().mark(function M(F,D){return f()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,re.request)("/api/user/mute/info",A()({method:"GET",params:A()({},F)},D||{})));case 1:case"end":return g.stop()}},M)})),Vn.apply(this,arguments)}function ti(M,F){return Gn.apply(this,arguments)}function Gn(){return Gn=B()(f()().mark(function M(F,D){return f()().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",(0,re.request)("/api/user/mute/remove",A()({method:"POST",params:A()({},F)},D||{})));case 1:case"end":return g.stop()}},M)})),Gn.apply(this,arguments)}var me=p(7651),It=p(28508),ri=p(43929),Ua=p(12399),si=p(24147),bt=p(74842),ii=p(63437),rn=p(82061),li=p(45128),wt=p(27496),Pt=p(51042),Nt=p(93045),Tt=p(16801),Ft=p(42365),oi=p(97302),ui=p(59223),ci=p(85502),_a=p(55241),Sa=p(68997),Et=p(38925),di=p(86738),ja=p(17788),we=p(55742),mi=p(11941),sn=p(32983),Mt=p(91907),a={chatRoom:"chatRoom___z4hOy",announcement:"announcement___BScRi",announcementContent:"announcementContent___sahN6",announcementIcon:"announcementIcon___AyWdl","floating-fish":"floating-fish___bJSU6",float:"float___amRPo",fish1:"fish1___fl6SU",swimLeft:"swimLeft___xopCT",fish2:"fish2___WiP1_",swimRight:"swimRight___scYp7",fish3:"fish3___irA44",bubble1:"bubble1___lxZ8Z",floatUp:"floatUp___eqvRq",bubble2:"bubble2___lsgr7",userList:"userList___AyZ7o",messageContainer:"messageContainer___zUc1q",loadingWrapper:"loadingWrapper___u6Ro0",messageItem:"messageItem___UXffF",self:"self___qONI1",messageHeader:"messageHeader___ABpsT",avatar:"avatar___zrh3f",senderInfo:"senderInfo___F2m3s",senderName:"senderName___s5UP3",messageContent:"messageContent___BeZJv",timestamp:"timestamp___pqcve",messageFooter:"messageFooter___eWkrw","ant-avatar":"ant-avatar___ClRnC",avatarWithFrame:"avatarWithFrame___X54kF",levelBadge:"levelBadge___XJap_",adminIcon:"adminIcon___K2evj",messageImage:"messageImage___mjbkk",quotedMessage:"quotedMessage___BmMMj",quotedMessageHeader:"quotedMessageHeader____yusK",quotedMessageSender:"quotedMessageSender___pirQn",quotedMessageTime:"quotedMessageTime___MwnJ1",quotedMessageContent:"quotedMessageContent___pji4Y",revokeText:"revokeText___zZ_gr",highlighted:"highlighted___bDS1N",highlight:"highlight___vmD0l",mentioned:"mentioned___y4vZW",userListHeader:"userListHeader___ZcTHO",userListContent:"userListContent___Kv4aS",userItem:"userItem___ImK7I",userInfo:"userInfo___BPLhU",userName:"userName___I3NJl",userStatus:"userStatus___vO3s5",inputArea:"inputArea___KNPKm",imagePreview:"imagePreview___wNZfH",previewWrapper:"previewWrapper___U5YU1",previewImage:"previewImage___JikMg",removeImage:"removeImage___I1y4R",inputRow:"inputRow___kMy91",chatTextArea:"chatTextArea___P0JAV",emoticonButton:"emoticonButton___BDTAm",musicButton:"musicButton___V2h3D",redPacketButton:"redPacketButton___cuOy3",imageUploadButton:"imageUploadButton___UkQ6y",anticon:"anticon___KrXaA",sendButton:"sendButton___gOHpp",inputCounter:"inputCounter___X1zvI",emoticonPopover:"emoticonPopover___ajmZW","ant-btn":"ant-btn___PxyOd",quoteText:"quoteText___reQEz",quotePreview:"quotePreview___sWx9r",quotePreviewContent:"quotePreviewContent___ARo1K",quotePreviewSender:"quotePreviewSender___Nhrx1",quotePreviewText:"quotePreviewText___ciyMi",removeQuote:"removeQuote___XDdAW",mobileToolbar:"mobileToolbar___9TylL",mobileToolRow:"mobileToolRow___II169",mobileTool:"mobileTool___nqSdx",mobileToolIcon:"mobileToolIcon___nr4Sw",mobileToolText:"mobileToolText___Zhibw",mobileSendButton:"mobileSendButton___YhPwz",mobilePlusButton:"mobilePlusButton___d6zgb",emojiPicker:"emojiPicker___sXzKA",emojiPopover:"emojiPopover___QpsPo",urlCard:"urlCard___w7Gqi",urlLink:"urlLink___Teb5n",adminTag:"adminTag___lL0Ow",slideInFromLeft:"slideInFromLeft___C9edg",shine:"shine___qK2ie",adminText:"adminText___jDfqg",levelTagMaster:"levelTagMaster___OVm95",levelTagExpert:"levelTagExpert___A8h6P",levelTagPro:"levelTagPro___DQDgH",levelTagBeginner:"levelTagBeginner___lzdIG",levelTagNewbie:"levelTagNewbie___U3D9y",titleTagAdmin:"titleTagAdmin___Pd4u6",titleTagInvestor:"titleTagInvestor___DUbJ4",titleTagChief:"titleTagChief___sEmoR",flowingLight:"flowingLight___Y_owa",glowing:"glowing___EbzAQ",rotate:"rotate___VFjrh",pulse:"pulse___sqloL",titleTagPlatinum:"titleTagPlatinum___pqEZo",titleTagGold:"titleTagGold___pApLj",titleTagBuilder:"titleTagBuilder___Ui4IO",avatarWrapper:"avatarWrapper___OIakS",userShortId:"userShortId___J0dMu",adminTagWrapper:"adminTagWrapper___Q06Eq",userInfoCard:"userInfoCard___KbRpI",userInfoCardHeader:"userInfoCardHeader___FyWAW",floatingFish:"floatingFish___v8UTJ",swim:"swim___DWAsC",userInfoCardTitle:"userInfoCardTitle___nAmMW",userInfoCardNameRow:"userInfoCardNameRow___Q1QQO",userInfoCardName:"userInfoCardName___UEhV5",userInfoCardLevel:"userInfoCardLevel___xsqj5",levelEmoji:"levelEmoji___bbPhc",levelText:"levelText___eiFSP",titlesContainer:"titlesContainer___pKfgl",expandButton:"expandButton___Wtx_o",userInfoCardPoints:"userInfoCardPoints___K4IPo",pointsEmoji:"pointsEmoji___SjnUH",pointsText:"pointsText___S3G3Y",userInfoCardLocation:"userInfoCardLocation___rBOBf",locationEmoji:"locationEmoji___E5zIt",locationText:"locationText___byW_A",filePreview:"filePreview___Lzsqg",fileInfo:"fileInfo___XZ29j",fileIcon:"fileIcon___cN2it",fileName:"fileName___lDlKn",removeFile:"removeFile___bS3iV",fileButton:"fileButton___SetA2",inviteMessage:"inviteMessage___UztQa",inviteContent:"inviteContent___LNqhr",inviteText:"inviteText___TNaif",inviteButton:"inviteButton___jaPKG",avatarFrame:"avatarFrame___fOQCF",mentionList:"mentionList___aXTEH",mentionItem:"mentionItem___Yitdk",mentionName:"mentionName___zugjr",redPacketMessage:"redPacketMessage___wVLkP",redPacketContent:"redPacketContent___ms917",redPacketInfo:"redPacketInfo___BITKE",redPacketTitle:"redPacketTitle___SuAOL",redPacketText:"redPacketText____4Zfz",redPacketStatus:"redPacketStatus___Qm3V9",redPacketActions:"redPacketActions___pK6Gw",redPacketIcon:"redPacketIcon___QwXzI",grabRedPacketButton:"grabRedPacketButton___rWEZO",viewRecordsButton:"viewRecordsButton___hMwhh",redPacketForm:"redPacketForm___UH_OD",formItem:"formItem___DhS_i",label:"label___uh3F4",redPacketRecords:"redPacketRecords___rASL5",recordsList:"recordsList___Sf4Q8",recordItem:"recordItem___diPQ4",luckyKing:"luckyKing___gFgBI",grabTime:"grabTime___qJpGH",amount:"amount___rU9ia",emptyRecords:"emptyRecords___dmmdv",emptyIcon:"emptyIcon___vYZU7",redPacketModal:"redPacketModal___AckcS",redPacketModalTitle:"redPacketModalTitle___TN3Dw",redPacketTitleIcon:"redPacketTitleIcon___wL_xl",redPacketTypeGroup:"redPacketTypeGroup___BoXoB",typeIcon:"typeIcon___pzhIx",amountInput:"amountInput___kM1s1",countInput:"countInput___xSYV3",messageInput:"messageInput___i_Pkr",userItemPlaceholder:"userItemPlaceholder___uSyFO",shimmer:"shimmer____sKnu",avatarPlaceholder:"avatarPlaceholder___R1yHK",infoPlaceholder:"infoPlaceholder___fyFvU",namePlaceholder:"namePlaceholder___qLQ0o",statusPlaceholder:"statusPlaceholder___TzcGY",virtualList:"virtualList___z9_30",titlesPopover:"titlesPopover___QIGj0",expandedTitles:"expandedTitles___fBtbk",expandedTitle:"expandedTitle___vwrom",hidePlaceholderOnMobile:"hidePlaceholderOnMobile___BqK1c",musicSearch:"musicSearch___MCoWQ","ant-input-search":"ant-input-search___quSof",musicList:"musicList___JIDwz",musicMessage:"musicMessage___lI3w_",musicWrapper:"musicWrapper___QDGd6",musicCover:"musicCover___P5X2y",musicContent:"musicContent___wUkye",musicInfo:"musicInfo___iAV9A",musicListItem:"musicListItem___qHxs9",musicTitle:"musicTitle___Z0K3C",musicDesc:"musicDesc___vmKrR",musicPlayer:"musicPlayer___UZ0Xe",musicFloatingPlayer:"musicFloatingPlayer___CGrMo",musicArtist:"musicArtist___rJRnq",progressBar:"progressBar___l5XMu",progress:"progress___LnDDM",timeInfo:"timeInfo___IM7pH",controls:"controls___yHDXK",userDetailModal:"userDetailModal___mZs4a",userDetailHeader:"userDetailHeader___HrsNn",userDetailInfo:"userDetailInfo___ht7db",userDetailName:"userDetailName___GjqPt",userDetailId:"userDetailId___LPa8w",userDetailContent:"userDetailContent___nepfw",userDetailItem:"userDetailItem___grqsn",itemLabel:"itemLabel___nyrO8",itemValue:"itemValue___y03I8",pointsContainer:"pointsContainer___RSeBq","ant-btn-link":"ant-btn-link___UbTzr",pointsEditContainer:"pointsEditContainer___TvYiI","ant-input-number":"ant-input-number___UQCHn","ant-input":"ant-input___soCLp",userDetailActions:"userDetailActions___HUQXu","ant-btn-dangerous":"ant-btn-dangerous___G6Zt5","ant-btn-default":"ant-btn-default___cCSP6"},vi=function(){var F=(0,l.useState)([]),D=v()(F,2),L=D[0],g=D[1],xe=(0,l.useState)("double"),ge=v()(xe,2),Pe=ge[0],Ca=ge[1],Ne=(0,l.useState)("big"),J=v()(Ne,2),Wa=J[0],ya=J[1],ka=(0,l.useState)(""),se=v()(ka,2),Te=se[0],_e=se[1],Ge=(0,l.useState)(!1),Ke=v()(Ge,2),xa=Ke[0],Qe=Ke[1],ta=(0,l.useState)(!1),ra=v()(ta,2),Ia=ra[0],Ie=ra[1],Se=(0,l.useRef)(null),oe=(0,l.useRef)(null),Oa=(0,re.useModel)("@@initialState"),ba=Oa.initialState,Je=ba||{},c=Je.currentUser,wa=Q.ZP.useMessage(),Fe=v()(wa,2),C=Fe[0],Pa=Fe[1],Na=(0,l.useState)([]),sa=v()(Na,2),ie=sa[0],be=sa[1],Ha=(0,l.useState)(!0),ia=v()(Ha,2),qe=ia[0],la=ia[1],Ee=(0,l.useRef)(!1),Xe=(0,l.useState)(1),Me=v()(Xe,2),Ta=Me[0],oa=Me[1],Fa=(0,l.useState)(0),ua=v()(Fa,2),ye=ua[0],ce=ua[1],$a=(0,l.useState)(!1),De=v()($a,2),za=De[0],W=De[1],d=(0,l.useState)(!0),y=v()(d,2),k=y[0],Z=y[1],w=10,P=(0,l.useState)(new Set),j=v()(P,1),_=j[0],N=(0,l.useRef)(!1),ne=(0,l.useState)('\u6B22\u8FCE\u6765\u5230\u6478\u9C7C\u804A\u5929\u5BA4\uFF01\u{1F389} \u8FD9\u91CC\u662F\u4E00\u4E2A\u5145\u6EE1\u5FEB\u4E50\u7684\u5730\u65B9~\u3002\u81F4\u8C22\uFF1A\u611F\u8C22 yovvis \u5927\u4F6C\u8D5E\u52A9\u7684\u670D\u52A1\u5668\u8D44\u6E90\u{1F31F}\uFF0C\u57DF\u540D9\u6708\u4EFD\u8FC7\u671F\uFF0C\u8BF7\u79FB\u6B65\u65B0\u57DF\u540D\uFF1A<a href="https://yucoder.cn/" target="_blank" rel="noopener noreferrer">https://yucoder.cn/</a>'),T=v()(ne,2),de=T[0],Y=T[1],ve=(0,l.useState)(!0),X=v()(ve,2),Ye=X[0],Va=X[1],Dt=(0,l.useState)(!0),q=v()(Dt,2),Ae=q[0],ln=q[1],pi=(0,l.useState)(!1),At=v()(pi,2),Ea=At[0],Bt=At[1],hi=(0,l.useState)(null),Rt=v()(hi,2),Zt=Rt[0],gi=Rt[1],_i=(0,l.useState)(!1),Lt=v()(_i,2),Si=Lt[0],Ut=Lt[1],ji=(0,l.useState)(null),Wt=v()(ji,2),Ma=Wt[0],on=Wt[1],Ci=(0,l.useState)(null),Ot=v()(Ci,2),un=Ot[0],Kn=Ot[1],yi=(0,l.useState)([]),Ht=v()(yi,2),ki=Ht[0],xi=Ht[1],Ii=(0,l.useState)(!1),$t=v()(Ii,2),Bo=$t[0],zt=$t[1],bi=(0,l.useState)(null),Vt=v()(bi,2),Ga=Vt[0],Qn=Vt[1],Gt=(0,l.useRef)(null),wi=(0,l.useState)(null),Kt=v()(wi,2),$=Kt[0],Pi=Kt[1],Ka=(0,l.useRef)(null),Ni=(0,l.useState)(!1),Qt=v()(Ni,2),Ti=Qt[0],cn=Qt[1],Fi=(0,l.useState)({top:0,left:0}),Jt=v()(Fi,2),qt=Jt[0],Ei=Jt[1],Mi=(0,l.useState)([]),Xt=v()(Mi,2),Yt=Xt[0],Di=Xt[1],Ai=(0,l.useState)(""),er=v()(Ai,2),Bi=er[0],ar=er[1],Jn=(0,l.useRef)(null),Ri=(0,l.useState)(!1),nr=v()(Ri,2),Zi=nr[0],dn=nr[1],Li=(0,l.useState)(0),tr=v()(Li,2),qn=tr[0],rr=tr[1],Ui=(0,l.useState)(1),sr=v()(Ui,2),Xn=sr[0],ir=sr[1],Wi=(0,l.useState)("\u606D\u559C\u53D1\u8D22\uFF0C\u5927\u5409\u5927\u5229\uFF01"),lr=v()(Wi,2),or=lr[0],ur=lr[1],Oi=(0,l.useState)(1),cr=v()(Oi,2),dr=cr[0],Hi=cr[1],$i=(0,l.useState)(!1),mr=v()($i,2),Yn=mr[0],et=mr[1],Qa=(0,l.useRef)(null),zi=(0,l.useState)(!1),vr=v()(zi,2),Vi=vr[0],fr=vr[1],Gi=(0,l.useState)([]),pr=v()(Gi,2),hr=pr[0],Ki=pr[1],Qi=(0,l.useState)(""),gr=v()(Qi,2),Ro=gr[0],Ji=gr[1],qi=(0,l.useState)(null),_r=v()(qi,2),Zo=_r[0],Lo=_r[1],Xi=(0,l.useState)(new Map),Sr=v()(Xi,2),jr=Sr[0],Yi=Sr[1],el=(0,l.useState)(!1),Cr=v()(el,2),al=Cr[0],mn=Cr[1],nl=(0,l.useState)(""),yr=v()(nl,2),vn=yr[0],kr=yr[1],tl=(0,l.useState)([]),xr=v()(tl,2),at=xr[0],Ir=xr[1],rl=(0,l.useState)(!1),br=v()(rl,2),fn=br[0],nt=br[1],Ja=(0,l.useRef)(null),sl=(0,l.useState)(!1),wr=v()(sl,2),Pr=wr[0],Nr=wr[1],il=(0,l.useState)(null),Tr=v()(il,2),Fr=Tr[0],Er=Tr[1],ll=(0,l.useState)(null),Mr=v()(ll,2),Dr=Mr[0],ca=Mr[1],ol=(0,l.useState)(!1),Ar=v()(ol,2),Br=Ar[0],Rr=Ar[1],ul=(0,l.useState)(!1),Zr=v()(ul,2),cl=Zr[0],qa=Zr[1],dl=(0,l.useState)(null),Lr=v()(dl,2),H=Lr[0],Ur=Lr[1],ml=function(){var r=B()(f()().mark(function n(){var t,s,m;return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(vn.trim()){o.next=3;break}return C.warning("\u8BF7\u8F93\u5165\u641C\u7D22\u5173\u952E\u8BCD"),o.abrupt("return");case 3:return o.prev=3,Nr(!0),ca(null),Rr(!0),o.next=9,fetch("https://api.kxzjoker.cn/api/163_search?name=".concat(encodeURIComponent(vn),"&limit=20"));case 9:if(s=o.sent,s.ok){o.next=12;break}throw new Error("\u641C\u7D22\u8BF7\u6C42\u5931\u8D25: ".concat(s.status));case 12:return o.next=14,s.json();case 14:if(m=o.sent,m.code===200){o.next=17;break}throw new Error("\u97F3\u4E50API\u8FD4\u56DE\u9519\u8BEF");case 17:Ir(m.data||[]),((t=m.data)===null||t===void 0?void 0:t.length)===0&&C.info("\u672A\u627E\u5230\u76F8\u5173\u6B4C\u66F2"),o.next=26;break;case 21:o.prev=21,o.t0=o.catch(3),console.error("\u641C\u7D22\u97F3\u4E50\u5931\u8D25:",o.t0),ca("\u97F3\u4E50\u641C\u7D22\u670D\u52A1\u6682\u65F6\u4E0D\u53EF\u7528\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5"),C.error("\u641C\u7D22\u97F3\u4E50\u5931\u8D25\uFF0C\u97F3\u4E50API\u53EF\u80FD\u6682\u65F6\u4E0D\u53EF\u7528");case 26:return o.prev=26,Nr(!1),o.finish(26);case 29:case"end":return o.stop()}},n,null,[[3,21,26,29]])}));return function(){return r.apply(this,arguments)}}(),vl=function(){var r=B()(f()().mark(function n(t){return f()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!fn){m.next=3;break}return C.warning("\u6B63\u5728\u5904\u7406\u4E0A\u4E00\u9996\u6B4C\uFF0C\u8BF7\u7A0D\u5019..."),m.abrupt("return");case 3:Ja.current&&clearTimeout(Ja.current);try{nt(!0),ca(null),Ja.current=setTimeout(B()(f()().mark(function i(){var o,u,S;return f()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.prev=0,x.next=3,fetch("https://api.kxzjoker.cn/api/163_music",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:new URLSearchParams({url:t.id,level:"lossless",type:"json"}).toString()});case 3:if(o=x.sent,o.ok){x.next=6;break}throw new Error("\u83B7\u53D6\u97F3\u4E50\u94FE\u63A5\u8BF7\u6C42\u5931\u8D25: ".concat(o.status));case 6:return x.next=8,o.json();case 8:if(u=x.sent,u.url){x.next=11;break}throw new Error("\u672A\u80FD\u83B7\u53D6\u5230\u97F3\u4E50\u94FE\u63A5");case 11:S="\u{1F3B5} ".concat(t.name," - ").concat(t.artists.map(function(G){return G.name}).join(",")," [music]").concat(u.url,"[/music][cover]").concat(u.pic,"[/cover]"),pn(S),mn(!1),kr(""),Ir([]),x.next=23;break;case 18:x.prev=18,x.t0=x.catch(0),console.error("\u83B7\u53D6\u97F3\u4E50\u94FE\u63A5\u5931\u8D25:",x.t0),ca("\u97F3\u4E50\u89E3\u6790\u670D\u52A1\u6682\u65F6\u4E0D\u53EF\u7528\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5"),C.error("\u83B7\u53D6\u97F3\u4E50\u94FE\u63A5\u5931\u8D25\uFF0C\u97F3\u4E50API\u53EF\u80FD\u6682\u65F6\u4E0D\u53EF\u7528");case 23:return x.prev=23,nt(!1),x.finish(23);case 26:case"end":return x.stop()}},i,null,[[0,18,23,26]])})),500)}catch(i){nt(!1),C.error("\u5904\u7406\u97F3\u4E50\u9009\u62E9\u65F6\u51FA\u9519")}case 5:case"end":return m.stop()}},n)}));return function(t){return r.apply(this,arguments)}}();(0,l.useEffect)(function(){return function(){Ja.current&&clearTimeout(Ja.current)}},[]);var fl=(0,l.useState)(0),Wr=v()(fl,2),pl=Wr[0],hl=Wr[1],gl=(0,l.useState)(""),Or=v()(gl,2),_l=Or[0],Sl=Or[1],jl=(0,l.useState)(0),Hr=v()(jl,2),Cl=Hr[0],yl=Hr[1],kl=46,Da=(0,l.useRef)(null),xl=(0,l.useState)(0),$r=v()(xl,2),Il=$r[0],bl=$r[1],wl=(0,l.useState)(Date.now()),zr=v()(wl,2),Pl=zr[0],Vr=zr[1],Nl=(0,l.useState)(0),Gr=v()(Nl,2),Tl=Gr[0],tt=Gr[1],ea=(0,l.useRef)(null),Fl=(0,l.useState)(!1),Kr=v()(Fl,2),Uo=Kr[0],Qr=Kr[1],da=function(){var n=oe.current;n&&requestAnimationFrame(function(){n.scrollTo({top:n.scrollHeight,behavior:"smooth"}),setTimeout(function(){n.scrollTop+n.clientHeight<n.scrollHeight&&n.scrollTo({top:n.scrollHeight,behavior:"smooth"})},100)})},El=function(n){C.destroy("newMessage"),C.info({content:(0,e.jsxs)("div",{onClick:function(){C.destroy("newMessage"),da()},style:{cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,e.jsxs)("span",{children:["\u6536\u5230 ",n," \u6761\u65B0\u6D88\u606F\uFF0C\u70B9\u51FB\u67E5\u770B"]}),(0,e.jsx)(It.Z,{onClick:function(s){s.stopPropagation(),C.destroy("newMessage")},style:{marginLeft:"10px",cursor:"pointer",color:"#999",fontSize:"12px"}})]}),duration:3,key:"newMessage"})},Xa=(0,l.useCallback)(function(){if(Da.current){var r,n=((r=Da.current.parentElement)===null||r===void 0?void 0:r.clientHeight)||0,t=40,s=20,m=Math.max(n-t-s,200);bl(m)}},[]);(0,l.useEffect)(function(){var r,n=new ResizeObserver(function(t){var s=pe()(t),m;try{for(s.s();!(m=s.n()).done;){var i,o=m.value;o.target===((i=Da.current)===null||i===void 0?void 0:i.parentElement)&&Xa()}}catch(u){s.e(u)}finally{s.f()}});return(r=Da.current)!==null&&r!==void 0&&r.parentElement&&n.observe(Da.current.parentElement),Xa(),window.addEventListener("resize",Xa),function(){n.disconnect(),window.removeEventListener("resize",Xa)}},[Xa]);var Ml=function(n){var t=n.index,s=n.style,m=ee()(ie).sort(function(o,u){return(u.points||0)-(o.points||0)}),i=m[t];return(0,e.jsxs)("div",{className:a.userItem,onClick:function(){return hn(i)},style:A()(A()({},s),{},{cursor:"pointer"}),children:[(0,e.jsx)("div",{className:a.avatarWrapper,children:(0,e.jsx)(_a.Z,{content:(0,e.jsx)(ts,{user:i}),trigger:"hover",placement:"right",children:(0,e.jsx)("div",{className:a.avatarWithFrame,children:(0,e.jsx)(Sa.Z,{src:i.avatar,size:28})})})}),(0,e.jsxs)("div",{className:a.userInfo,children:[(0,e.jsx)("div",{className:a.userName,children:i.name}),(0,e.jsx)("div",{className:a.userStatus,children:i.status})]}),(0,e.jsx)("span",{className:a.levelBadge,children:gn(i.level)})]},i.id)},Dl=function(){var r=B()(f()().mark(function n(){var t,s,m,i,o,u;return f()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.prev=0,h.next=3,fetch("https://ip.renfei.net/?lang=zh-CN");case 3:return t=h.sent,h.next=6,t.json();case 6:return s=h.sent,m=s.clientIP,i="https://api.allorigins.win/raw?url=".concat(encodeURIComponent("http://ip-api.com/json/".concat(m,"?lang=zh-CN"))),h.next=11,fetch(i);case 11:return o=h.sent,h.next=14,o.json();case 14:u=h.sent,u.status==="success"&&(console.log("IP\u4FE1\u606F:",{IP:u.query,\u56FD\u5BB6:u.country,\u7701\u4EFD:u.regionName,\u57CE\u5E02:u.city,\u8FD0\u8425\u5546:u.isp,\u7ECF\u7EAC\u5EA6:"".concat(u.lat,", ").concat(u.lon)}),Pi({region:u.regionName,country:u.country})),h.next=21;break;case 18:h.prev=18,h.t0=h.catch(0),console.error("\u83B7\u53D6IP\u4FE1\u606F\u5931\u8D25:",h.t0);case 21:case"end":return h.stop()}},n,null,[[0,18]])}));return function(){return r.apply(this,arguments)}}();(0,l.useEffect)(function(){Dl()},[]);var Al=function(){var r=B()(f()().mark(function n(){var t,s,m;return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,Js();case 3:t=o.sent,t.data&&(s=t.data.map(function(u){return{id:String(u.id),name:u.name||"\u672A\u77E5\u7528\u6237",avatar:u.avatar||"https://api.dicebear.com/7.x/avataaars/svg?seed=visitor",level:u.level||1,isAdmin:u.isAdmin||!1,status:"\u5728\u7EBF",points:u.points||0,avatarFramerUrl:u.avatarFramerUrl,titleId:u.titleId,titleIdList:u.titleIdList}}),m={id:"-1",name:"\u6478\u9C7C\u52A9\u624B",avatar:"https://api.oss.cqbo.com/moyu/user_avatar/1/hYskW0jH-34eaba5c-3809-45ef-a3bd-dd01cf97881b_478ce06b6d869a5a11148cf3ee119bac.gif",level:1,isAdmin:!1,status:"\u5728\u7EBF",points:9999,region:"\u9C7C\u5858",country:"\u6478\u9C7C\u5C9B",avatarFramerUrl:"",titleId:0,titleIdList:""},s.unshift(m),c!=null&&c.id&&!s.some(function(u){return u.id===String(c.id)})&&s.push({id:String(c.id),name:c.userName||"\u672A\u77E5\u7528\u6237",avatar:c.userAvatar||"https://api.dicebear.com/7.x/avataaars/svg?seed=visitor",level:c.level||1,isAdmin:c.userRole==="admin",status:"\u5728\u7EBF",points:c.points||0,avatarFramerUrl:c.avatarFramerUrl,titleId:c.titleId,titleIdList:c.titleIdList}),be(s)),o.next=11;break;case 7:o.prev=7,o.t0=o.catch(0),console.error("\u83B7\u53D6\u5728\u7EBF\u7528\u6237\u5217\u8868\u5931\u8D25:",o.t0),C.error("\u83B7\u53D6\u5728\u7EBF\u7528\u6237\u5217\u8868\u5931\u8D25");case 11:case"end":return o.stop()}},n,null,[[0,7]])}));return function(){return r.apply(this,arguments)}}();(0,l.useEffect)(function(){qe&&setTimeout(function(){da()},100)},[L]),(0,l.useEffect)(function(){Al()},[]);var Jr=function(){var r=B()(f()().mark(function n(t){var s,m,i,o,u,S,h,x,G,U=arguments;return f()().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:if(s=U.length>1&&U[1]!==void 0?U[1]:!1,!(!k||N.current)){R.next=3;break}return R.abrupt("return");case 3:return R.prev=3,N.current=!0,W(!0),i=oe.current,o=(i==null?void 0:i.scrollHeight)||0,R.next=10,Qs({current:t,pageSize:w,roomId:-1,sortField:"createTime",sortOrder:"desc"});case 10:u=R.sent,(m=u.data)!==null&&m!==void 0&&m.records&&(S=new Set,h=u.data.records.map(function(b){var K,le,V,fe,je,ke,Re,Ze,Le,Ue,We,Oe,Ba,Ra,mt,vt,ft,pt,ht,gt,He,$e,ze,Ve,kn=String((K=b.messageWrapper)===null||K===void 0||(K=K.message)===null||K===void 0?void 0:K.id);return S.has(kn)||_.has(kn)?null:(S.add(kn),{id:kn,content:((le=b.messageWrapper)===null||le===void 0||(le=le.message)===null||le===void 0?void 0:le.content)||"",sender:{id:String(b.userId),name:((V=b.messageWrapper)===null||V===void 0||(V=V.message)===null||V===void 0||(V=V.sender)===null||V===void 0?void 0:V.name)||"\u672A\u77E5\u7528\u6237",avatar:((fe=b.messageWrapper)===null||fe===void 0||(fe=fe.message)===null||fe===void 0||(fe=fe.sender)===null||fe===void 0?void 0:fe.avatar)||"https://api.dicebear.com/7.x/avataaars/svg?seed=visitor",level:((je=b.messageWrapper)===null||je===void 0||(je=je.message)===null||je===void 0||(je=je.sender)===null||je===void 0?void 0:je.level)||1,points:((ke=b.messageWrapper)===null||ke===void 0||(ke=ke.message)===null||ke===void 0||(ke=ke.sender)===null||ke===void 0?void 0:ke.points)||0,isAdmin:((Re=b.messageWrapper)===null||Re===void 0||(Re=Re.message)===null||Re===void 0||(Re=Re.sender)===null||Re===void 0?void 0:Re.isAdmin)||!1,region:((Ze=b.messageWrapper)===null||Ze===void 0||(Ze=Ze.message)===null||Ze===void 0||(Ze=Ze.sender)===null||Ze===void 0?void 0:Ze.region)||"\u672A\u77E5\u5730\u533A",country:(Le=b.messageWrapper)===null||Le===void 0||(Le=Le.message)===null||Le===void 0||(Le=Le.sender)===null||Le===void 0?void 0:Le.country,avatarFramerUrl:(Ue=b.messageWrapper)===null||Ue===void 0||(Ue=Ue.message)===null||Ue===void 0||(Ue=Ue.sender)===null||Ue===void 0?void 0:Ue.avatarFramerUrl,titleId:(We=b.messageWrapper)===null||We===void 0||(We=We.message)===null||We===void 0||(We=We.sender)===null||We===void 0?void 0:We.titleId,titleIdList:(Oe=b.messageWrapper)===null||Oe===void 0||(Oe=Oe.message)===null||Oe===void 0||(Oe=Oe.sender)===null||Oe===void 0?void 0:Oe.titleIdList},timestamp:new Date(((Ba=b.messageWrapper)===null||Ba===void 0||(Ba=Ba.message)===null||Ba===void 0?void 0:Ba.timestamp)||Date.now()),quotedMessage:(Ra=b.messageWrapper)!==null&&Ra!==void 0&&(Ra=Ra.message)!==null&&Ra!==void 0&&Ra.quotedMessage?{id:String(b.messageWrapper.message.quotedMessage.id),content:b.messageWrapper.message.quotedMessage.content||"",sender:{id:String((mt=b.messageWrapper.message.quotedMessage.sender)===null||mt===void 0?void 0:mt.id),name:((vt=b.messageWrapper.message.quotedMessage.sender)===null||vt===void 0?void 0:vt.name)||"\u672A\u77E5\u7528\u6237",avatar:((ft=b.messageWrapper.message.quotedMessage.sender)===null||ft===void 0?void 0:ft.avatar)||"https://api.dicebear.com/7.x/avataaars/svg?seed=visitor",level:((pt=b.messageWrapper.message.quotedMessage.sender)===null||pt===void 0?void 0:pt.level)||1,points:((ht=b.messageWrapper.message.quotedMessage.sender)===null||ht===void 0?void 0:ht.points)||0,isAdmin:((gt=b.messageWrapper.message.quotedMessage.sender)===null||gt===void 0?void 0:gt.isAdmin)||!1,region:((He=b.messageWrapper)===null||He===void 0||(He=He.message.quotedMessage)===null||He===void 0||(He=He.sender)===null||He===void 0?void 0:He.region)||"\u672A\u77E5\u5730\u533A",avatarFramerUrl:($e=b.messageWrapper)===null||$e===void 0||($e=$e.message.quotedMessage)===null||$e===void 0||($e=$e.sender)===null||$e===void 0?void 0:$e.avatarFramerUrl,titleId:(ze=b.messageWrapper)===null||ze===void 0||(ze=ze.message.quotedMessage)===null||ze===void 0||(ze=ze.sender)===null||ze===void 0?void 0:ze.titleId,titleIdList:(Ve=b.messageWrapper)===null||Ve===void 0||(Ve=Ve.message.quotedMessage)===null||Ve===void 0||(Ve=Ve.sender)===null||Ve===void 0?void 0:Ve.titleIdList},timestamp:new Date(b.messageWrapper.message.quotedMessage.timestamp||Date.now())}:void 0,region:($==null?void 0:$.region)||"\u672A\u77E5\u5730\u533A"})}).filter(Boolean),h.forEach(function(b){return _.add(b.id)}),s&&h.length>0&&(x=h[h.length-1],Vr(new Date(x.timestamp).getTime())),s?g(h.reverse()):h.length>0&&g(function(b){return[].concat(ee()(h.reverse()),ee()(b))}),ce(u.data.total||0),G=_.size,Z(G<(u.data.total||0)),h.length>0&&oa(t),s?setTimeout(function(){da()},100):requestAnimationFrame(function(){if(i){var b=i.scrollHeight;i.scrollTop=b-o}})),R.next=18;break;case 14:R.prev=14,R.t0=R.catch(3),C.error("\u52A0\u8F7D\u5386\u53F2\u6D88\u606F\u5931\u8D25"),console.error("\u52A0\u8F7D\u5386\u53F2\u6D88\u606F\u5931\u8D25:",R.t0);case 18:return R.prev=18,W(!1),N.current=!1,R.finish(18);case 22:case"end":return R.stop()}},n,null,[[3,14,18,22]])}));return function(t){return r.apply(this,arguments)}}(),Bl=function(){var n=oe.current;if(n){var t=100,s=n.scrollHeight-n.scrollTop-n.clientHeight;la(s<=t)}},rt=function(){var n=oe.current;if(!(!n||N.current||!k)&&(Bl(),n.scrollTop===0)){var t=Ta+1;k&&Jr(t)}};(0,l.useEffect)(function(){Jr(1,!0)},[]),(0,l.useEffect)(function(){var r=oe.current;if(r)return r.addEventListener("scroll",rt),function(){return r.removeEventListener("scroll",rt)}},[N.current,k,Ta]);var qr=function(){var r=B()(f()().mark(function n(t){var s,m;return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,Bt(!0),!(t.size>1048576)){o.next=7;break}return o.next=5,Rl(t);case 5:s=o.sent,s&&(t=s);case 7:return o.next=9,(0,xt.TV)({biz:"user_file"},{},t,{headers:{"Content-Type":"multipart/form-data"}});case 9:if(m=o.sent,m.data){o.next=12;break}throw new Error("\u56FE\u7247\u4E0A\u4F20\u5931\u8D25");case 12:on(m.data),o.next=18;break;case 15:o.prev=15,o.t0=o.catch(0),C.error("\u4E0A\u4F20\u5931\u8D25\uFF1A".concat(o.t0));case 18:return o.prev=18,Bt(!1),o.finish(18);case 21:case"end":return o.stop()}},n,null,[[0,15,18,21]])}));return function(t){return r.apply(this,arguments)}}(),Rl=function(n){return new Promise(function(t,s){var m=new FileReader;m.readAsDataURL(n),m.onload=function(i){var o,u=new Image;u.src=(o=i.target)===null||o===void 0?void 0:o.result,u.onload=function(){var S,h=document.createElement("canvas"),x=u.width,G=u.height,U=2e3;(x>U||G>U)&&(x>G?(G=Math.round(G*U/x),x=U):(x=Math.round(x*U/G),G=U)),h.width=x,h.height=G;var O=h.getContext("2d");if(!O){s(new Error("\u65E0\u6CD5\u521B\u5EFA\u753B\u5E03\u4E0A\u4E0B\u6587"));return}O.drawImage(u,0,0,x,G);for(var R=.9,b=h.toDataURL("image/jpeg",R);b.length>1024*1024&&R>.1;)R-=.1,b=h.toDataURL("image/jpeg",R);for(var K=b.split(","),le=(S=K[0].match(/:(.*?);/))===null||S===void 0?void 0:S[1],V=atob(K[1]),fe=V.length,je=new Uint8Array(fe);fe--;)je[fe]=V.charCodeAt(fe);var ke=new File([je],n.name,{type:le||"image/jpeg"});t(ke)},u.onerror=function(){return s(new Error("\u56FE\u7247\u52A0\u8F7D\u5931\u8D25"))}},m.onerror=function(){return s(new Error("\u6587\u4EF6\u8BFB\u53D6\u5931\u8D25"))}})},Zl=function(){var r=B()(f()().mark(function n(t){var s,m,i;return f()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:s=t.clipboardData.items,m=0;case 2:if(!(m<s.length)){u.next=13;break}if(s[m].type.indexOf("image")===-1){u.next=10;break}if(t.preventDefault(),i=s[m].getAsFile(),!i){u.next=9;break}return u.next=9,qr(i);case 9:return u.abrupt("break",13);case 10:m++,u.next=2;break;case 13:case"end":return u.stop()}},n)}));return function(t){return r.apply(this,arguments)}}(),Ll=function(){Kn(null)},Wo=function(){var r=B()(f()().mark(function n(t){var s,m;return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,zt(!0),o.next=4,(0,xt.TV)({biz:"user_file"},{},t,{headers:{"Content-Type":"multipart/form-data"}});case 4:if(s=o.sent,s.data){o.next=7;break}throw new Error("\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25");case 7:m=s.data,console.log("\u6587\u4EF6\u4E0A\u4F20\u5730\u5740\uFF1A",m),Qn(m),C.success("\u6587\u4EF6\u4E0A\u4F20\u6210\u529F"),o.next=16;break;case 13:o.prev=13,o.t0=o.catch(0),C.error("\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25\uFF1A".concat(o.t0));case 16:return o.prev=16,zt(!1),o.finish(16);case 19:case"end":return o.stop()}},n,null,[[0,13,16,19]])}));return function(t){return r.apply(this,arguments)}}(),Ul=function(){Qn(null)},Wl=function(n){var t=document.getElementById("message-".concat(n));t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add(a.highlighted),setTimeout(function(){t.classList.remove(a.highlighted)},2e3))},Ol=function(n){var t;(t=n.mentionedUsers)!==null&&t!==void 0&&t.some(function(s){return s.id===String(c==null?void 0:c.id)})&&(C.info({content:(0,e.jsxs)("div",{onClick:function(){return Wl(n.id)},children:[n.sender.name," \u5728\u6D88\u606F\u4E2D\u63D0\u5230\u4E86\u4F60"]}),duration:5,key:n.id}),xi(function(s){return[].concat(ee()(s),[n])}))},Xr=function(n){var t=n.data.message,s=new Date(t.timestamp).getTime();if(t.sender.id!==String(c==null?void 0:c.id)){var m=s>Pl;g(function(S){var h=[].concat(ee()(S),[A()({},t)]),x=oe.current;if(x){var G=30,U=x.scrollHeight-x.scrollTop-x.clientHeight,O=U<=G;if(!O&&m&&(tt(function(R){return R+1}),ea.current&&clearTimeout(ea.current),ea.current=setTimeout(function(){El(Tl+1),tt(0)},1e3)),O&&h.length>25)return h.slice(-25)}return h}),m&&(Vr(s),Ol(t));var i=oe.current;if(i){var o=30,u=i.scrollHeight-i.scrollTop-i.clientHeight;u<=o&&(setTimeout(da,100),tt(0),ea.current&&(clearTimeout(ea.current),ea.current=null))}}},Yr=function(n){g(function(t){return t.filter(function(s){return s.id!==n.data})}),ce(function(t){return Math.max(0,t-1)})},es=function(n){be(function(t){return[].concat(ee()(t),ee()(n.data.filter(function(s){return!t.some(function(m){return m.id===s.id})})))})},as=function(n){be(function(t){return t.filter(function(s){return s.id!==n.data})})};(0,l.useEffect)(function(){if(ln(!0),Ee.current=!1,c!=null&&c.id){var r=localStorage.getItem("tokenValue");if(!r){C.error("\u8BF7\u5148\u767B\u5F55\uFF01");return}return me.o.addMessageHandler("chat",Xr),me.o.addMessageHandler("userMessageRevoke",Yr),me.o.addMessageHandler("userOnline",es),me.o.addMessageHandler("userOffline",as),me.o.connect(r),function(){ln(!1),Ee.current=!0,me.o.removeMessageHandler("chat",Xr),me.o.removeMessageHandler("userMessageRevoke",Yr),me.o.removeMessageHandler("userOnline",es),me.o.removeMessageHandler("userOffline",as)}}},[c==null?void 0:c.id]);var pn=function(n){if(n!=null&&n.startsWith("/workday ")){var t=n.split(" ")[1];if(["single","double","mixed"].includes(t)){Ca(t),C.success("\u5DE5\u4F5C\u5236\u5DF2\u8BBE\u7F6E\u4E3A".concat(t==="single"?"\u5355\u4F11":t==="double"?"\u53CC\u4F11":"\u5927\u5C0F\u5468"));return}}if(n!=null&&n.startsWith("/week ")){var s=n.split(" ")[1];if(["big","small"].includes(s)){ya(s),C.success("\u5F53\u524D\u5468\u7C7B\u578B\u5DF2\u8BBE\u7F6E\u4E3A".concat(s==="big"?"\u5927\u5468":"\u5C0F\u5468"));return}}var m=Date.now();if(m-pl<1e3){C.warning("\u53D1\u9001\u592A\u5FEB\u4E86\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5");return}var i=n||Te,o=/\<iframe.*?\>.*?\<\/iframe\>/gi;if(o.test(i)){C.warning("\u4E3A\u4E86\u5B89\u5168\u8003\u8651\uFF0C\u4E0D\u652F\u6301 iframe \u6807\u7B7E");return}if(Ma&&(i="[img]".concat(Ma,"[/img]").concat(i)),Ga&&(i="[file]".concat(Ga,"[/file]").concat(i)),!i.trim()&&!Ma&&!Ga){C.warning({content:"\u8BF7\u8F93\u5165\u6D88\u606F\u5185\u5BB9",key:"emptyMessage"});return}if(i===_l&&m-Cl<1e4){C.warning("\u8BF7\u52FF\u91CD\u590D\u53D1\u9001\u76F8\u540C\u5185\u5BB9\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5");return}if(!(c!=null&&c.id)){C.error("\u8BF7\u5148\u767B\u5F55\uFF01");return}for(var u=[],S=/@([a-zA-Z0-9_\u4e00-\u9fa5]+)/g,h,x=function(){var O=h[1],R=ie.find(function(b){return b.name===O});R&&u.push(R)};(h=S.exec(i))!==null;)x();var G={id:"".concat(Date.now()),content:i,sender:{id:String(c.id),name:c.userName||"\u6E38\u5BA2",avatar:c.userAvatar||"https://api.dicebear.com/7.x/avataaars/svg?seed=visitor",level:c.level||1,points:c.points||0,isAdmin:c.userRole==="admin",region:($==null?void 0:$.region)||"\u672A\u77E5\u5730\u533A",country:($==null?void 0:$.country)||"\u672A\u77E5\u56FD\u5BB6",avatarFramerUrl:c.avatarFramerUrl,titleId:c.titleId,titleIdList:c.titleIdList},timestamp:new Date,quotedMessage:un||void 0,mentionedUsers:u.length>0?u:void 0,region:($==null?void 0:$.region)||"\u672A\u77E5\u5730\u533A",country:($==null?void 0:$.country)||"\u672A\u77E5\u56FD\u5BB6"};me.o.send({type:2,userId:-1,data:{type:"chat",content:{message:G}}}),g(function(U){return[].concat(ee()(U),[G])}),ce(function(U){return U+1}),Z(!0),_e(""),on(null),Qn(null),Kn(null),hl(m),Sl(i),yl(m),setTimeout(da,100),dt()},Hl=function(){on(null)},$l=function(n){me.o.send({type:2,userId:-1,data:{type:"userMessageRevoke",content:n}}),C.info("\u6D88\u606F\u5DF2\u64A4\u56DE")},zl=function(n){var t=n.target.value;t=t.replace(/```/g,""),_e(t);var s=t.trim().length>0;if(bs(s),s&&an&&dt(),t==="#\u6478\u9C7C\u65E5\u5386"){us(),_e(""),bs(!1);return}var m=t.lastIndexOf("@");if(m!==-1){var i=t.slice(m+1);ar(i);var o=ie.filter(function(V){return!V||!V.name?!1:V.name.toLowerCase().includes(i.toLowerCase())});Di(o);var u=n.target,S=u.getBoundingClientRect(),h=u.selectionStart,x=parseInt(getComputedStyle(u).lineHeight),G=t.slice(0,h).split(`
`),U=G[G.length-1],O=U.length,R=40,b=3,K=Math.min(o.length,b)*R,le=o.length<=b?-K:-200;Ei({top:S.top+le,left:S.left+O*8}),cn(!0)}else cn(!1)};(0,l.useEffect)(function(){var r=function(t){Jn.current&&!Jn.current.contains(t.target)&&cn(!1)};return document.addEventListener("mousedown",r),function(){document.removeEventListener("mousedown",r)}},[]);var hn=function(n){var t=Te,s=t.lastIndexOf("@");if(s!==-1){var m=t.slice(0,s)+"@".concat(n.name," ")+t.slice(s+Bi.length+1);_e(m)}else{var i,o=((i=Ka.current)===null||i===void 0?void 0:i.selectionStart)||0,u=t.slice(0,o)+"@".concat(n.name," ")+t.slice(o);_e(u)}cn(!1),ar(""),setTimeout(function(){var S;(S=Ka.current)===null||S===void 0||S.focus()},0)},ns=function(n){if(/^\d+$/.test(n)){var t=parseInt(n).toString(16).toUpperCase();return"#".concat(t.padStart(4,"0").slice(0,4))}return"#".concat(n.slice(0,4).padEnd(4,"0").toUpperCase())},ts=function(n){var t=n.user,s=t.titleIdList?JSON.parse(t.titleIdList):[],m=(0,l.useState)(!1),i=v()(m,2),o=i[0],u=i[1],S=ns(t.id),h=[_n(t.isAdmin,t.level,0)].concat(ee()(s.map(function(U){return _n(t.isAdmin,t.level,U)}))),x=t.titleId&&h.find(function(U){var O,R;if(t.titleId===-1&&((O=U.props)===null||O===void 0||(O=O.children)===null||O===void 0||(O=O[1])===null||O===void 0||(O=O.props)===null||O===void 0?void 0:O.children)==="\u7BA1\u7406\u5458")return!0;var b=p(79614).F,K=b.find(function(le){return String(le.id)===String(t.titleId)});return K&&K.name===((R=U.props)===null||R===void 0||(R=R.children)===null||R===void 0||(R=R[1])===null||R===void 0||(R=R.props)===null||R===void 0?void 0:R.children)})||h[0],G=h.filter(function(U){return U!==x});return(0,e.jsx)("div",{className:a.userInfoCard,onMouseLeave:function(){return u(!1)},children:(0,e.jsxs)("div",{className:a.userInfoCardHeader,children:[(0,e.jsxs)("div",{className:a.avatarWrapper,onClick:function(O){O.stopPropagation(),hn(t)},children:[(0,e.jsx)(_a.Z,{content:(0,e.jsx)("div",{className:a.userShortId,children:S}),trigger:"hover",placement:"bottom",children:(0,e.jsxs)("div",{className:a.avatarWithFrame,children:[(0,e.jsx)(Sa.Z,{src:t.avatar,size:48}),t.avatarFramerUrl&&(0,e.jsx)("img",{src:t.avatarFramerUrl,className:a.avatarFrame,alt:"avatar-frame"})]})}),(0,e.jsx)("div",{className:a.floatingFish,children:"\u{1F41F}"})]}),(0,e.jsxs)("div",{className:a.userInfoCardTitle,children:[(0,e.jsxs)("div",{className:a.userInfoCardNameRow,children:[(0,e.jsx)("span",{className:a.userInfoCardName,children:t.name}),(0,e.jsxs)("span",{className:a.userInfoCardLevel,children:[(0,e.jsx)("span",{className:a.levelEmoji,children:gn(t.level)}),(0,e.jsx)("span",{className:a.levelText,children:t.level})]})]}),(0,e.jsxs)("div",{className:a.titlesContainer,children:[x,G.length>0&&(0,e.jsx)(_a.Z,{content:(0,e.jsx)("div",{className:a.expandedTitles,children:G.map(function(U,O){return(0,e.jsx)("div",{className:a.expandedTitle,children:U},O)})}),trigger:"click",placement:"right",overlayClassName:a.titlesPopover,open:o,onOpenChange:u,children:(0,e.jsx)(I.ZP,{type:"text",size:"small",className:a.expandButton,icon:(0,e.jsx)(ri.Z,{}),onClick:function(O){O.stopPropagation(),u(!o)}})})]}),(0,e.jsxs)("div",{className:a.userInfoCardPoints,children:[(0,e.jsx)("span",{className:a.pointsEmoji,children:"\u2728"}),(0,e.jsxs)("span",{className:a.pointsText,children:["\u79EF\u5206: ",t.points||0]})]}),t.id===String(c==null?void 0:c.id)?$&&(0,e.jsxs)("div",{className:a.userInfoCardLocation,children:[(0,e.jsx)("span",{className:a.locationEmoji,children:"\u{1F4CD}"}),(0,e.jsxs)("span",{className:a.locationText,children:[$.country," \xB7 ",$.region]})]}):t.region&&(0,e.jsxs)("div",{className:a.userInfoCardLocation,children:[(0,e.jsx)("span",{className:a.locationEmoji,children:"\u{1F4CD}"}),(0,e.jsx)("span",{className:a.locationText,children:t.country?"".concat(t.country," \xB7 ").concat(t.region):t.region})]})]})]})})},Vl=function(n){Kn(n),setTimeout(function(){var t;(t=Ka.current)===null||t===void 0||t.focus()},0)},gn=function(n){switch(n){case 7:return"\u{1F451}";case 6:return"\u{1F4AB}";case 5:return"\u{1F3D6}";case 4:return"\u{1F3A3}";case 3:return"\u2B50";case 2:return"\u{1F423}";case 1:return"\u{1F4A6}";default:return"\u{1F4A6}"}},_n=function(n,t,s){if(s!==void 0&&s!=0){var m=p(79614).F,i=m.find(function(G){return String(G.id)===String(s)});if(i){var o="",u="";switch(String(s)){case"-1":o="\u{1F680}",u=a.titleTagAdmin;break;case"1":o="\u{1F607}",u=a.titleTagInvestor;break;case"2":o="\u{1F3C6}",u=a.titleTagChief;break;case"3":o="\u{1F48E}",u=a.titleTagPlatinum;break;case"4":o="\u{1F31F}",u=a.titleTagGold;break;case"5":o="\u{1F6E0}\uFE0F",u=a.titleTagBuilder;break;default:o="\u{1F3AF}",u=a.levelTagBeginner}return(0,e.jsxs)("span",{className:"".concat(a.adminTag," ").concat(u),children:[o,(0,e.jsx)("span",{className:a.adminText,children:i.name})]})}}var S="",h="",x="";switch(t){case 7:S="\u6478\u9C7C\u7687\u5E1D",h="\u{1F451}",x=a.levelTagMaster;break;case 6:S="\u8EBA\u5E73\u5B97\u5E08",h="\u{1F4AB}",x=a.levelTagExpert;break;case 5:S="\u6446\u70C2\u5927\u5E08",h="\u{1F3D6}\uFE0F",x=a.levelTagPro;break;case 4:S="\u6478\u9C7C\u4E13\u5BB6 ",h="\u{1F3A3}",x=a.levelTagAdvanced;break;case 3:S="\u6C34\u7FA4\u8FBE\u4EBA",h="\u2B50",x=a.levelTagBeginner;break;case 2:S="\u6478\u9C7C\u5B66\u5F92",h="\u{1F423}",x=a.levelTagNewbie;break;default:S="\u5212\u6C34\u65B0\u79C0",h="\u{1F4A6}",x=a.levelTagNewbie}return(0,e.jsxs)("span",{className:"".concat(a.adminTag," ").concat(x),children:[h,(0,e.jsx)("span",{className:a.adminText,children:S})]})},Gl=function(n){_e(function(t){return t+n.native}),Qe(!1),setTimeout(function(){var t;(t=Ka.current)===null||t===void 0||t.focus()},0)},Kl=(0,e.jsx)("div",{className:a.emojiPicker,children:(0,e.jsx)(ci.Z,{data:ui,i18n:ue,onEmojiSelect:Gl,theme:"light",locale:"zh",previewPosition:"none",skinTonePosition:"none"})}),Ql=function(n){var t="[img]".concat(n,"[/img]");if(_e(t),!!me.o.isConnected()){if(!(c!=null&&c.id)){C.error("\u8BF7\u5148\u767B\u5F55\uFF01");return}var s={id:"".concat(Date.now()),content:t,sender:{id:String(c.id),name:c.userName||"\u6E38\u5BA2",avatar:c.userAvatar||"https://api.dicebear.com/7.x/avataaars/svg?seed=visitor",level:c.level||1,points:c.points||0,isAdmin:c.userRole==="admin",region:($==null?void 0:$.region)||"\u672A\u77E5\u5730\u533A",country:($==null?void 0:$.country)||"\u672A\u77E5\u56FD\u5BB6",avatarFramerUrl:c.avatarFramerUrl,titleId:c.titleId,titleIdList:c.titleIdList},timestamp:new Date};g(function(m){return[].concat(ee()(m),[s])}),ce(function(m){return m+1}),Z(!0),me.o.send({type:2,userId:-1,data:{type:"chat",content:{message:s}}}),_e(""),Ie(!1),setTimeout(da,100)}},Jl=function(n,t){switch(t){case"chess":localStorage.setItem("piece_join_status","new"),re.history.push("/game/piece?roomId=".concat(n,"&mode=online"));break;case"chineseChess":re.history.push("/game/chineseChess?roomId=".concat(n,"&mode=online"));break;default:break}},ql=function(){var r=B()(f()().mark(function n(){return f()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!Yn){s.next=3;break}return C.warning("\u6B63\u5728\u5904\u7406\u7EA2\u5305\u53D1\u9001\uFF0C\u8BF7\u7A0D\u5019..."),s.abrupt("return");case 3:if(c!=null&&c.id){s.next=6;break}return C.error("\u8BF7\u5148\u767B\u5F55\uFF01"),s.abrupt("return");case 6:if(!(qn<=0||Xn<=0)){s.next=9;break}return C.error("\u8BF7\u8F93\u5165\u6709\u6548\u7684\u7EA2\u5305\u91D1\u989D\u548C\u6570\u91CF\uFF01"),s.abrupt("return");case 9:Qa.current&&clearTimeout(Qa.current);try{et(!0),Qa.current=setTimeout(B()(f()().mark(function m(){var i,o;return f()().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return S.prev=0,S.next=3,qs({totalAmount:qn,count:Xn,type:dr,name:or});case 3:i=S.sent,i.data&&(o={id:"".concat(Date.now()),content:"[redpacket]".concat(i.data,"[/redpacket]"),sender:{id:String(c.id),name:c.userName||"\u6E38\u5BA2",avatar:c.userAvatar||"https://api.dicebear.com/7.x/avataaars/svg?seed=visitor",level:c.level||1,points:c.points||0,isAdmin:c.userRole==="admin",region:($==null?void 0:$.region)||"\u672A\u77E5\u5730\u533A",country:($==null?void 0:$.country)||"\u672A\u77E5\u56FD\u5BB6",avatarFramerUrl:c.avatarFramerUrl,titleId:c.titleId,titleIdList:c.titleIdList},timestamp:new Date},me.o.send({type:2,userId:-1,data:{type:"chat",content:{message:o}}}),g(function(h){return[].concat(ee()(h),[o])}),ce(function(h){return h+1}),Z(!0),C.success("\u7EA2\u5305\u53D1\u9001\u6210\u529F\uFF01"),dn(!1),rr(0),ir(1),ur("\u606D\u559C\u53D1\u8D22\uFF0C\u5927\u5409\u5927\u5229\uFF01")),S.next=10;break;case 7:S.prev=7,S.t0=S.catch(0),C.error("\u7EA2\u5305\u53D1\u9001\u5931\u8D25\uFF01");case 10:return S.prev=10,et(!1),S.finish(10);case 13:case"end":return S.stop()}},m,null,[[0,7,10,13]])})),500)}catch(m){et(!1),C.error("\u7EA2\u5305\u53D1\u9001\u5931\u8D25\uFF01")}case 11:case"end":return s.stop()}},n)}));return function(){return r.apply(this,arguments)}}(),rs=function(){var r=B()(f()().mark(function n(t){var s,m,i;return f()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(s=jr.get(t),s===void 0){u.next=3;break}return u.abrupt("return",s);case 3:return u.prev=3,u.next=6,Xs({redPacketId:t});case 6:if(m=u.sent,!m.data){u.next=11;break}return i=m.data,Yi(function(S){return new Map(S).set(t,i)}),u.abrupt("return",i);case 11:u.next=16;break;case 13:u.prev=13,u.t0=u.catch(3),console.error("\u83B7\u53D6\u7EA2\u5305\u8BE6\u60C5\u5931\u8D25:",u.t0);case 16:return u.abrupt("return",null);case 17:case"end":return u.stop()}},n,null,[[3,13]])}));return function(t){return r.apply(this,arguments)}}(),Xl=function(){var r=B()(f()().mark(function n(t){return f()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return Ji(t),fr(!0),m.next=4,os(t);case 4:case"end":return m.stop()}},n)}));return function(t){return r.apply(this,arguments)}}(),Yl=(0,l.useState)(null),ss=v()(Yl,2),Ya=ss[0],is=ss[1],eo=(0,l.useState)(!1),ls=v()(eo,2),st=ls[0],Sn=ls[1],Be=(0,l.useRef)(null),ao=function(){!Be.current||!Ya||(st?Be.current.pause():Be.current.play(),Sn(!st))},no=function(){Be.current&&Be.current.pause(),is(null),Sn(!1)},Oo=function(n){var t=Math.floor(n/60),s=Math.floor(n%60);return"".concat(t,":").concat(s.toString().padStart(2,"0"))},it=function(n){var t=/\[music\]([^\[\]]*)\[\/music\]/i.exec(n),s=/\[cover\]([^\[\]]*)\[\/cover\]/i.exec(n);if(t){var m=t[1],i=s?s[1]:"",o=n.split("[music]")[0];return(0,e.jsx)("div",{className:a.musicMessage,children:(0,e.jsxs)("div",{className:a.musicWrapper,children:[i&&(0,e.jsx)("img",{src:i,alt:"album cover",className:a.musicCover}),(0,e.jsxs)("div",{className:a.musicContent,children:[(0,e.jsx)("div",{className:a.musicInfo,children:o}),(0,e.jsx)("audio",{controls:!0,src:m,style:{width:"100%",minWidth:"300px"},onPlay:function(K){Be.current&&Be.current!==K.currentTarget&&Be.current.pause();var le=K.currentTarget;Be.current=le,is({name:o.split(" - ")[0].replace("\u{1F3B5} ",""),artists:o.split(" - ")[1],url:m,cover:i,progress:0,duration:le.duration}),Sn(!0)},onEnded:function(){Sn(!1)}})]})]})})}var u=/\[redpacket\]([^\[\]]*)\[\/redpacket\]/i.exec(n);if(u){var S=u[1],h=jr.get(S);return h||rs(S),(0,e.jsx)("div",{className:a.redPacketMessage,children:(0,e.jsxs)("div",{className:a.redPacketContent,children:[(0,e.jsx)(Ua.Z,{className:a.redPacketIcon}),(0,e.jsxs)("div",{className:a.redPacketInfo,children:[(0,e.jsxs)("div",{className:a.redPacketTitle,children:[(0,e.jsx)("span",{className:a.redPacketText,children:(h==null?void 0:h.name)||"\u7EA2\u5305"}),(0,e.jsx)("span",{className:a.redPacketStatus,children:(h==null?void 0:h.remainingCount)===0?"\uFF08\u5DF2\u62A2\u5B8C\uFF09":(h==null?void 0:h.status)===2?"\uFF08\u5DF2\u8FC7\u671F\uFF09":"\uFF08\u5269\u4F59".concat((h==null?void 0:h.remainingCount)||0,"\u4E2A\uFF09")})]}),(0,e.jsxs)("div",{className:a.redPacketActions,children:[(0,e.jsx)(I.ZP,{type:"primary",size:"small",onClick:B()(f()().mark(function b(){var K;return f()().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return V.prev=0,V.next=3,Ys({redPacketId:S});case 3:if(K=V.sent,!K.data){V.next=8;break}return C.success("\u606D\u559C\u4F60\u62A2\u5230 ".concat(K.data," \u79EF\u5206\uFF01")),V.next=8,Promise.all([os(S),rs(S)]);case 8:V.next=13;break;case 10:V.prev=10,V.t0=V.catch(0),C.error("\u7EA2\u5305\u5DF2\u88AB\u62A2\u5B8C\u6216\u5DF2\u8FC7\u671F\uFF01");case 13:case"end":return V.stop()}},b,null,[[0,10]])})),className:a.grabRedPacketButton,disabled:(h==null?void 0:h.remainingCount)===0||(h==null?void 0:h.status)===2,children:"\u62A2\u7EA2\u5305"}),(0,e.jsx)(I.ZP,{type:"link",size:"small",onClick:function(){return Xl(S)},className:a.viewRecordsButton,children:"\u67E5\u770B\u8BB0\u5F55"})]})]})]})})}var x=/\[invite\/([a-zA-Z0-9_]+)\]([0-9]+)\[\/invite\]/i.exec(n);if(x){var G=x[2],U=x[1],O="";switch(U){case"chess":O="\u4E94\u5B50\u68CB";break;case"chineseChess":O="\u4E2D\u56FD\u8C61\u68CB";break}return(0,e.jsx)("div",{className:a.inviteMessage,children:(0,e.jsxs)("div",{className:a.inviteContent,children:[(0,e.jsxs)("span",{className:a.inviteText,children:["\u{1F3AE} ",O,"\u5BF9\u6218\u9080\u8BF7"]}),(0,e.jsx)(I.ZP,{type:"primary",size:"small",onClick:function(){return Jl(G,U)},className:a.inviteButton,children:"\u52A0\u5165\u5BF9\u6218"})]})})}var R=/\[img\]([^\[\]]*)\[\/img\]/i.exec(n);return R?(0,e.jsx)(yt,{content:n,onImageLoad:function(){var K=L[L.length-1],le=(K==null?void 0:K.content)===n;le&&(qe||(K==null?void 0:K.sender.id)===String(c==null?void 0:c.id))&&da()}}):(0,e.jsx)(yt,{content:n})},os=function(){var r=B()(f()().mark(function n(t){var s,m;return f()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,ei({redPacketId:t});case 3:s=o.sent,s.data&&(m=ee()(s.data).sort(function(u,S){return(S.amount||0)-(u.amount||0)}),Ki(m)),o.next=10;break;case 7:o.prev=7,o.t0=o.catch(0),C.error("\u83B7\u53D6\u7EA2\u5305\u8BB0\u5F55\u5931\u8D25\uFF01");case 10:case"end":return o.stop()}},n,null,[[0,7]])}));return function(t){return r.apply(this,arguments)}}();(0,l.useEffect)(function(){return function(){ea.current&&clearTimeout(ea.current),Qa.current&&clearTimeout(Qa.current)}},[]);var us=function(){var r=B()(f()().mark(function n(){var t,s;return f()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,Qr(!0),i.next=4,fetch("https://api.vvhan.com/api/moyu?type=json");case 4:return t=i.sent,i.next=7,t.json();case 7:s=i.sent,s.success?on(s.url):C.error("\u83B7\u53D6\u6478\u9C7C\u65E5\u5386\u5931\u8D25"),i.next=14;break;case 11:i.prev=11,i.t0=i.catch(0),C.error("\u83B7\u53D6\u6478\u9C7C\u65E5\u5386\u5931\u8D25");case 14:return i.prev=14,Qr(!1),i.finish(14);case 17:case"end":return i.stop()}},n,null,[[0,11,14,17]])}));return function(){return r.apply(this,arguments)}}(),to=(0,l.useState)("search"),cs=v()(to,2),ro=cs[0],so=cs[1],io=(0,l.useState)([]),ds=v()(io,2),Aa=ds[0],lt=ds[1],en=(0,l.useRef)(null),ae=(0,l.useRef)(null);(0,l.useEffect)(function(){var r=localStorage.getItem("music_playlist");if(r)try{lt(JSON.parse(r))}catch(t){console.error("\u52A0\u8F7D\u6B4C\u5355\u5931\u8D25:",t)}var n=function(){if(!(document.getElementById("aplayer-css")||document.getElementById("aplayer-js"))){var s=document.createElement("link");s.id="aplayer-css",s.rel="stylesheet",s.href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css",document.head.appendChild(s);var m=document.createElement("script");m.id="aplayer-js",m.src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js",m.async=!0,document.body.appendChild(m)}};return n(),function(){ae.current&&(ae.current.destroy(),ae.current=null)}},[]);var lo=function(){var r=B()(f()().mark(function n(t){var s,m,i;return f()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,Er(t.id),ca(null),u.next=5,fetch("https://api.kxzjoker.cn/api/163_music",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:new URLSearchParams({url:t.id,level:"lossless",type:"json"}).toString()});case 5:if(s=u.sent,s.ok){u.next=8;break}throw new Error("\u83B7\u53D6\u97F3\u4E50\u94FE\u63A5\u8BF7\u6C42\u5931\u8D25: ".concat(s.status));case 8:return u.next=10,s.json();case 10:if(m=u.sent,m.url){u.next=13;break}throw new Error("\u672A\u80FD\u83B7\u53D6\u5230\u97F3\u4E50\u94FE\u63A5");case 13:i={id:t.id,name:t.name,artist:t.artists.map(function(S){return S.name}).join(","),url:m.url,cover:m.pic,album:t.album.name},lt(function(S){if(S.some(function(x){return x.id===i.id}))return C.info("\u6B4C\u66F2\u5DF2\u5728\u6B4C\u5355\u4E2D"),S;var h=[].concat(ee()(S),[i]);return localStorage.setItem("music_playlist",JSON.stringify(h)),C.success("\u5DF2\u6DFB\u52A0\u5230\u6B4C\u5355"),h}),u.next=22;break;case 17:u.prev=17,u.t0=u.catch(0),console.error("\u6DFB\u52A0\u6B4C\u66F2\u5931\u8D25:",u.t0),ca("\u97F3\u4E50\u89E3\u6790\u670D\u52A1\u6682\u65F6\u4E0D\u53EF\u7528\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5"),C.error("\u6DFB\u52A0\u6B4C\u66F2\u5931\u8D25\uFF0C\u97F3\u4E50API\u53EF\u80FD\u6682\u65F6\u4E0D\u53EF\u7528");case 22:return u.prev=22,Er(null),u.finish(22);case 25:case"end":return u.stop()}},n,null,[[0,17,22,25]])}));return function(t){return r.apply(this,arguments)}}(),oo=function(n){if(typeof window.APlayer=="undefined"){C.error("\u64AD\u653E\u5668\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5");return}if(!ae.current&&en.current)ae.current=new window.APlayer({container:en.current,audio:[n],autoplay:!0,theme:"#41b883",listFolded:!1,listMaxHeight:"200px"});else if(ae.current){ae.current.list.add(n);var t=ae.current.list.audios.findIndex(function(s){return s.id===n.id});t!==-1&&(ae.current.list.switch(t),ae.current.play())}},uo=function(){if(Aa.length===0){C.info("\u6B4C\u5355\u4E3A\u7A7A");return}if(typeof window.APlayer=="undefined"){C.error("\u64AD\u653E\u5668\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5");return}ae.current&&ae.current.destroy(),en.current&&(ae.current=new window.APlayer({container:en.current,audio:Aa,autoplay:!0,theme:"#41b883",listFolded:!1,listMaxHeight:"200px"}))},co=function(n){if(lt(function(i){var o=i.filter(function(u){return u.id!==n});return localStorage.setItem("music_playlist",JSON.stringify(o)),o}),ae.current){var t=ae.current.list.index,s=ae.current.list.audios[t];s&&s.id===n&&(ae.current.list.audios.length>1?ae.current.skipForward():ae.current.pause());var m=ae.current.list.audios.findIndex(function(i){return i.id===n});m!==-1&&ae.current.list.remove(m)}},mo=function(n){kr(n.target.value),Br&&n.target.value!==vn&&Rr(!1)},ms=function(){var r=B()(f()().mark(function n(t){var s;return f()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if((c==null?void 0:c.userRole)!=="admin"){i.next=14;break}return Ur(t),qa(!0),i.prev=3,i.next=6,ni({userId:t.id});case 6:s=i.sent,s.code===0&&s.data?Cn(s.data):Cn(null),i.next=14;break;case 10:i.prev=10,i.t0=i.catch(3),console.error("\u83B7\u53D6\u7528\u6237\u7981\u8A00\u72B6\u6001\u5931\u8D25:",i.t0),Cn(null);case 14:case"end":return i.stop()}},n,null,[[3,10]])}));return function(t){return r.apply(this,arguments)}}(),vo=function(n){!c||c.userRole!=="admin"||jn(!0)},fo=function(){var r=B()(f()().mark(function n(t){var s;return f()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(!c||c.userRole!=="admin")){i.next=2;break}return i.abrupt("return");case 2:return i.prev=2,i.next=5,ti({userId:t});case 5:s=i.sent,s.code===0&&s.data?(C.success("\u5DF2\u89E3\u9664\u7528\u6237\u7981\u8A00"),Cn(null)):C.error("\u89E3\u9664\u7981\u8A00\u5931\u8D25\uFF1A".concat(s.message)),i.next=13;break;case 9:i.prev=9,i.t0=i.catch(2),console.error("\u89E3\u9664\u7528\u6237\u7981\u8A00\u5931\u8D25:",i.t0),C.error("\u89E3\u9664\u7981\u8A00\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5");case 13:case"end":return i.stop()}},n,null,[[2,9]])}));return function(t){return r.apply(this,arguments)}}(),po=function(n){!c||c.userRole!=="admin"||(C.success("\u5DF2\u5C01\u7981\u7528\u6237 ID: ".concat(n)),qa(!1))},ho=(0,l.useState)(!1),vs=v()(ho,2),go=vs[0],fs=vs[1],_o=(0,l.useState)(0),ps=v()(_o,2),ot=ps[0],So=ps[1],jo=function(){H&&(C.success("\u5DF2\u4FEE\u6539\u7528\u6237 ".concat(H.name," \u7684\u79EF\u5206\u4E3A ").concat(ot)),fs(!1),Ur(A()(A()({},H),{},{points:ot})))},Co=(0,l.useState)(!1),hs=v()(Co,2),yo=hs[0],jn=hs[1],ko=(0,l.useState)(60),gs=v()(ko,2),ut=gs[0],_s=gs[1],xo=(0,l.useState)(void 0),Ss=v()(xo,2),aa=Ss[0],ct=Ss[1],Io=(0,l.useState)(!1),js=v()(Io,2),bo=js[0],Cs=js[1],wo=(0,l.useState)(null),ys=v()(wo,2),ma=ys[0],Cn=ys[1],Po=function(){var r=B()(f()().mark(function n(){var t,s;return f()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(H){i.next=2;break}return i.abrupt("return");case 2:return i.prev=2,Cs(!0),t=aa!==void 0?aa:ut,i.next=7,ai({userId:H.id,duration:Number(t)});case 7:s=i.sent,s.code===0?(C.success("\u5DF2\u7981\u8A00\u7528\u6237 ".concat(H.name,"\uFF0C\u65F6\u957F ").concat(ks(t))),jn(!1),qa(!1)):C.error("\u7981\u8A00\u5931\u8D25\uFF1A".concat(s.message)),i.next=15;break;case 11:i.prev=11,i.t0=i.catch(2),console.error("\u7981\u8A00\u7528\u6237\u5931\u8D25:",i.t0),C.error("\u7981\u8A00\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5");case 15:return i.prev=15,Cs(!1),ct(void 0),i.finish(15);case 19:case"end":return i.stop()}},n,null,[[2,11,15,19]])}));return function(){return r.apply(this,arguments)}}(),ks=function(n){return n<60?"".concat(n,"\u79D2"):n<3600?"".concat(Math.floor(n/60),"\u5206\u949F"):n<86400?"".concat(Math.floor(n/3600),"\u5C0F\u65F6"):"".concat(Math.floor(n/86400),"\u5929")},No=(0,l.useState)(!1),xs=v()(No,2),an=xs[0],yn=xs[1],To=(0,l.useState)(!1),Is=v()(To,2),Fo=Is[0],bs=Is[1],Eo=function(){yn(!an)},nn=function(n){var t;switch(n){case"emoji":Qe(!0);break;case"emoticon":Ie(!0);break;case"music":mn(!0);break;case"redPacket":dn(!0);break;case"image":(t=Gt.current)===null||t===void 0||t.click();break;case"calendar":us();break;default:break}yn(!1)},dt=function(){an&&yn(!1)};return(0,e.jsxs)("div",{className:a.chatRoom,children:[Ya&&(0,e.jsxs)("div",{className:a.musicFloatingPlayer,children:[(0,e.jsx)("img",{src:Ya.cover,alt:"cover",className:a.musicCover}),(0,e.jsxs)("div",{className:a.musicInfo,children:[(0,e.jsx)("div",{className:a.musicTitle,children:Ya.name}),(0,e.jsx)("div",{className:a.musicArtist,children:Ya.artists})]}),(0,e.jsxs)("div",{className:a.controls,children:[(0,e.jsx)(I.ZP,{type:"text",icon:st?(0,e.jsx)(si.Z,{}):(0,e.jsx)(bt.Z,{}),onClick:ao}),(0,e.jsx)(I.ZP,{type:"text",icon:(0,e.jsx)(It.Z,{}),onClick:no})]})]}),Pa,Ye&&(0,e.jsx)(Et.Z,{message:(0,e.jsxs)("div",{className:a.announcementContent,children:[(0,e.jsx)(ii.Z,{className:a.announcementIcon}),(0,e.jsx)("span",{dangerouslySetInnerHTML:{__html:de}})]}),type:"info",showIcon:!1,closable:!0,onClose:function(){return Va(!1)},className:a.announcement}),(0,e.jsx)("div",{className:a["floating-fish"]+" "+a.fish1,children:"\u{1F41F}"}),(0,e.jsx)("div",{className:a["floating-fish"]+" "+a.fish2,children:"\u{1F420}"}),(0,e.jsx)("div",{className:a["floating-fish"]+" "+a.fish3,children:"\u{1F421}"}),(0,e.jsx)("div",{className:a["floating-fish"]+" "+a.bubble1,children:"\u{1F4AD}"}),(0,e.jsx)("div",{className:a["floating-fish"]+" "+a.bubble2,children:"\u{1F4AD}"}),(0,e.jsxs)("div",{className:a.messageContainer,ref:oe,onScroll:rt,onClick:function(){an&&yn(!1)},children:[za&&(0,e.jsx)("div",{className:a.loadingWrapper,children:(0,e.jsx)(he.Z,{})}),L.map(function(r){return(0,e.jsxs)("div",{id:"message-".concat(r.id),className:"".concat(a.messageItem," ").concat(c!=null&&c.id&&String(r.sender.id)===String(c.id)?a.self:""," ").concat(ki.some(function(n){return n.id===r.id})?a.mentioned:""),children:[(0,e.jsxs)("div",{className:a.messageHeader,children:[(0,e.jsx)("div",{className:a.avatar,onClick:function(){return hn(r.sender)},style:{cursor:"pointer"},children:(0,e.jsx)(_a.Z,{content:(0,e.jsx)(ts,{user:r.sender}),trigger:"hover",placement:"top",children:(0,e.jsxs)("div",{className:a.avatarWithFrame,children:[(0,e.jsx)(Sa.Z,{src:r.sender.avatar,size:32}),r.sender.avatarFramerUrl&&(0,e.jsx)("img",{src:r.sender.avatarFramerUrl,className:a.avatarFrame,alt:"avatar-frame"})]})})}),(0,e.jsx)("div",{className:a.senderInfo,children:(0,e.jsxs)("span",{className:a.senderName,onClick:function(){return ms(r.sender)},style:(c==null?void 0:c.userRole)==="admin"?{cursor:"pointer"}:{},children:[r.sender.name,_n(r.sender.isAdmin,r.sender.level,r.sender.titleId),(0,e.jsxs)("span",{className:a.levelBadge,children:[gn(r.sender.level)," ",r.sender.level]})]})})]}),(0,e.jsxs)("div",{className:a.messageContent,children:[r.quotedMessage&&(0,e.jsxs)("div",{className:a.quotedMessage,children:[(0,e.jsxs)("div",{className:a.quotedMessageHeader,children:[(0,e.jsx)("span",{className:a.quotedMessageSender,onClick:function(){return r.quotedMessage&&ms(r.quotedMessage.sender)},style:(c==null?void 0:c.userRole)==="admin"?{cursor:"pointer"}:{},children:r.quotedMessage.sender.name}),(0,e.jsx)("span",{className:a.quotedMessageTime,children:new Date(r.quotedMessage.timestamp).toLocaleTimeString()})]}),(0,e.jsx)("div",{className:a.quotedMessageContent,children:it(r.quotedMessage.content)})]}),it(r.content)]}),(0,e.jsxs)("div",{className:a.messageFooter,children:[(0,e.jsx)("span",{className:a.timestamp,children:new Date(r.timestamp).toLocaleTimeString()}),c!=null&&c.id&&String(r.sender.id)===String(c.id)||(c==null?void 0:c.userRole)==="admin"?(0,e.jsx)(di.Z,{title:"\u786E\u5B9A\u8981\u64A4\u56DE\u8FD9\u6761\u6D88\u606F\u5417\uFF1F",onConfirm:function(){return $l(r.id)},okText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88",children:(0,e.jsx)("span",{className:a.revokeText,children:"\u64A4\u56DE"})}):null,(0,e.jsx)("span",{className:a.quoteText,onClick:function(){return Vl(r)},children:"\u5F15\u7528"})]})]},r.id)}),(0,e.jsx)("div",{ref:Se})]}),(0,e.jsxs)("div",{className:a.userList,children:[(0,e.jsxs)("div",{className:a.userListHeader,children:["\u5728\u7EBF\u6210\u5458 (",ie.length,")"]}),(0,e.jsx)("div",{className:a.userListContent,ref:Da,children:(0,e.jsx)(Mt.t7,{height:Il,itemCount:ie.length,itemSize:kl,width:"100%",children:Ml})})]}),(0,e.jsxs)("div",{className:a.inputArea,children:[un&&(0,e.jsxs)("div",{className:a.quotePreview,children:[(0,e.jsxs)("div",{className:a.quotePreviewContent,children:[(0,e.jsxs)("span",{className:a.quotePreviewSender,children:[un.sender.name,":"]}),(0,e.jsx)("span",{className:a.quotePreviewText,children:it(un.content)})]}),(0,e.jsx)(I.ZP,{type:"text",icon:(0,e.jsx)(rn.Z,{}),className:a.removeQuote,onClick:Ll})]}),Ma&&(0,e.jsx)("div",{className:a.imagePreview,children:(0,e.jsxs)("div",{className:a.previewWrapper,children:[(0,e.jsx)("img",{src:Ma,alt:"\u9884\u89C8\u56FE\u7247",className:a.previewImage,onClick:function(){gi(Ma),Ut(!0)}}),(0,e.jsx)(I.ZP,{type:"text",icon:(0,e.jsx)(rn.Z,{}),className:a.removeImage,onClick:Hl})]})}),Ga&&(0,e.jsx)("div",{className:a.filePreview,children:(0,e.jsxs)("div",{className:a.previewWrapper,children:[(0,e.jsxs)("div",{className:a.fileInfo,children:[(0,e.jsx)(li.Z,{className:a.fileIcon}),(0,e.jsx)("span",{className:a.fileName,children:Ga.split("/").pop()})]}),(0,e.jsx)(I.ZP,{type:"text",icon:(0,e.jsx)(rn.Z,{}),className:a.removeFile,onClick:Ul})]})}),(0,e.jsxs)("div",{className:a.inputRow,children:[(0,e.jsx)("input",{type:"file",ref:Gt,style:{display:"none"},onChange:function(n){var t,s=(t=n.target.files)===null||t===void 0?void 0:t[0];if(s){var m=["image/jpeg","image/png","image/gif","image/webp"];if(!m.includes(s.type)){C.error("\u53EA\u652F\u6301 JPG\u3001PNG\u3001GIF \u548C WEBP \u683C\u5F0F\u7684\u56FE\u7247");return}if(s.size>5*1024*1024){C.error("\u56FE\u7247\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC7 5MB");return}qr(s)}},accept:"image/jpeg,image/png,image/gif,image/webp",disabled:Ea}),Fo?(0,e.jsx)(I.ZP,{icon:(0,e.jsx)(wt.Z,{}),className:a.mobileSendButton,onClick:function(){return pn()},disabled:Ea,type:"primary"}):(0,e.jsx)(I.ZP,{icon:(0,e.jsx)(Pt.Z,{}),className:a.mobilePlusButton,onClick:function(n){n.stopPropagation(),Eo()},disabled:Ea}),(0,e.jsx)(_a.Z,{content:Kl,trigger:"click",visible:xa,onVisibleChange:Qe,placement:"topLeft",overlayClassName:a.emojiPopover,children:(0,e.jsx)(I.ZP,{icon:(0,e.jsx)(Nt.Z,{}),className:a.emojiButton})}),(0,e.jsx)(_a.Z,{content:(0,e.jsx)(Ks,{onSelect:Ql}),trigger:"click",visible:Ia,onVisibleChange:Ie,placement:"topLeft",overlayClassName:a.emoticonPopover,children:(0,e.jsx)(I.ZP,{icon:(0,e.jsx)(Tt.Z,{}),className:a.emoticonButton})}),(0,e.jsx)(I.ZP,{icon:(0,e.jsx)(Ft.Z,{}),className:a.musicButton,onClick:function(){return mn(!0)}}),((c==null?void 0:c.userRole)==="admin"||(c==null?void 0:c.level)&&c.level>=6)&&(0,e.jsx)(I.ZP,{icon:(0,e.jsx)(Ua.Z,{}),className:a.redPacketButton,onClick:function(){return dn(!0)}}),(0,e.jsx)(Ce.Z.TextArea,{ref:Ka,value:Te,onChange:zl,onFocus:dt,onKeyDown:function(n){if(n.key==="Enter"){if(n.nativeEvent.isComposing)return;n.shiftKey||(n.preventDefault(),pn())}},onPaste:Zl,placeholder:Ea?"\u6B63\u5728\u4E0A\u4F20\u56FE\u7247...":"\u8F93\u5165\u6D88\u606F\u6216\u7C98\u8D34\u56FE\u7247...",maxLength:200,disabled:Ea,autoSize:{minRows:1,maxRows:4},className:"".concat(a.chatTextArea," ").concat(a.hidePlaceholderOnMobile)}),Ti&&Yt.length>0&&(0,e.jsx)("div",{ref:Jn,className:a.mentionList,style:{position:"fixed",top:qt.top,left:qt.left,zIndex:1e3},children:Yt.map(function(r){return(0,e.jsxs)("div",{className:a.mentionItem,onClick:function(){return hn(r)},children:[(0,e.jsx)(Sa.Z,{src:r.avatar,size:24}),(0,e.jsx)("span",{className:a.mentionName,children:r.name})]},r.id)})}),(0,e.jsxs)("span",{className:a.inputCounter,children:[Te.length,"/200"]}),(0,e.jsx)(I.ZP,{type:"text",icon:(0,e.jsx)(wt.Z,{}),onClick:function(){return pn()},disabled:Ea,className:a.sendButton,children:"\u53D1\u9001"})]}),an&&(0,e.jsxs)("div",{className:a.mobileToolbar,onClick:function(n){n.stopPropagation()},children:[(0,e.jsxs)("div",{className:a.mobileToolRow,children:[(0,e.jsxs)("div",{className:a.mobileTool,onClick:function(){return nn("image")},children:[(0,e.jsx)("div",{className:a.mobileToolIcon,children:(0,e.jsx)(Tt.Z,{})}),(0,e.jsx)("div",{className:a.mobileToolText,children:"\u76F8\u518C"})]}),(0,e.jsxs)("div",{className:a.mobileTool,onClick:function(){return nn("emoticon")},children:[(0,e.jsx)("div",{className:a.mobileToolIcon,children:(0,e.jsx)(Nt.Z,{})}),(0,e.jsx)("div",{className:a.mobileToolText,children:"\u8868\u60C5"})]}),(0,e.jsxs)("div",{className:a.mobileTool,onClick:function(){return nn("music")},children:[(0,e.jsx)("div",{className:a.mobileToolIcon,children:(0,e.jsx)(Ft.Z,{})}),(0,e.jsx)("div",{className:a.mobileToolText,children:"\u97F3\u4E50"})]}),(0,e.jsxs)("div",{className:a.mobileTool,onClick:function(){return nn("calendar")},children:[(0,e.jsx)("div",{className:a.mobileToolIcon,children:(0,e.jsx)(oi.Z,{})}),(0,e.jsx)("div",{className:a.mobileToolText,children:"\u6478\u9C7C\u65E5\u5386"})]})]}),((c==null?void 0:c.userRole)==="admin"||(c==null?void 0:c.level)&&c.level>=6)&&(0,e.jsxs)("div",{className:a.mobileToolRow,children:[(0,e.jsxs)("div",{className:a.mobileTool,onClick:function(){return nn("redPacket")},children:[(0,e.jsx)("div",{className:a.mobileToolIcon,children:(0,e.jsx)(Ua.Z,{})}),(0,e.jsx)("div",{className:a.mobileToolText,children:"\u7EA2\u5305"})]}),(0,e.jsx)("div",{className:a.mobileTool,style:{visibility:"hidden"}}),(0,e.jsx)("div",{className:a.mobileTool,style:{visibility:"hidden"}}),(0,e.jsx)("div",{className:a.mobileTool,style:{visibility:"hidden"}})]})]})]}),(0,e.jsx)(ja.Z,{title:(0,e.jsxs)("div",{className:a.redPacketModalTitle,children:[(0,e.jsx)(Ua.Z,{className:a.redPacketTitleIcon}),(0,e.jsx)("span",{children:"\u53D1\u9001\u7EA2\u5305"})]}),open:Zi,onOk:ql,onCancel:function(){return dn(!1)},okText:Yn?"\u53D1\u9001\u4E2D...":"\u53D1\u9001",cancelText:"\u53D6\u6D88",okButtonProps:{loading:Yn},width:400,className:a.redPacketModal,children:(0,e.jsxs)("div",{className:a.redPacketForm,children:[(0,e.jsxs)("div",{className:a.formItem,children:[(0,e.jsx)("span",{className:a.label,children:"\u7EA2\u5305\u7C7B\u578B\uFF1A"}),(0,e.jsxs)(we.ZP.Group,{value:dr,onChange:function(n){return Hi(n.target.value)},className:a.redPacketTypeGroup,children:[(0,e.jsxs)(we.ZP.Button,{value:1,children:[(0,e.jsx)("span",{className:a.typeIcon,children:"\u{1F3B2}"}),(0,e.jsx)("span",{children:"\u968F\u673A\u7EA2\u5305"})]}),(0,e.jsxs)(we.ZP.Button,{value:2,children:[(0,e.jsx)("span",{className:a.typeIcon,children:"\u{1F4CA}"}),(0,e.jsx)("span",{children:"\u5E73\u5747\u7EA2\u5305"})]})]})]}),(0,e.jsxs)("div",{className:a.formItem,children:[(0,e.jsx)("span",{className:a.label,children:"\u7EA2\u5305\u91D1\u989D\uFF1A"}),(0,e.jsx)(Ce.Z,{type:"number",value:qn,onChange:function(n){return rr(Number(n.target.value))},min:1,placeholder:"\u8BF7\u8F93\u5165\u7EA2\u5305\u91D1\u989D",prefix:"\xA5",className:a.amountInput})]}),(0,e.jsxs)("div",{className:a.formItem,children:[(0,e.jsx)("span",{className:a.label,children:"\u7EA2\u5305\u4E2A\u6570\uFF1A"}),(0,e.jsx)(Ce.Z,{type:"number",value:Xn,onChange:function(n){return ir(Number(n.target.value))},min:1,placeholder:"\u8BF7\u8F93\u5165\u7EA2\u5305\u4E2A\u6570",className:a.countInput})]}),(0,e.jsxs)("div",{className:a.formItem,children:[(0,e.jsx)("span",{className:a.label,children:"\u795D\u798F\u8BED\uFF1A"}),(0,e.jsx)(Ce.Z.TextArea,{value:or,onChange:function(n){return ur(n.target.value)},placeholder:"\u606D\u559C\u53D1\u8D22\uFF0C\u5927\u5409\u5927\u5229\uFF01",maxLength:50,showCount:!0,className:a.messageInput})]})]})}),(0,e.jsx)(ja.Z,{open:Si,footer:null,onCancel:function(){return Ut(!1)},children:Zt&&(0,e.jsx)("img",{alt:"\u9884\u89C8",style:{width:"100%"},src:Zt})}),(0,e.jsx)(ja.Z,{title:"\u7EA2\u5305\u8BB0\u5F55",open:Vi,onCancel:function(){return fr(!1)},footer:null,width:400,children:(0,e.jsx)("div",{className:a.redPacketRecords,children:(0,e.jsx)("div",{className:a.recordsList,children:hr.length>0?hr.map(function(r,n){return(0,e.jsxs)("div",{className:a.recordItem,children:[(0,e.jsx)(Sa.Z,{src:r.userAvatar,size:32}),(0,e.jsxs)("div",{className:a.userInfo,children:[(0,e.jsxs)("div",{className:a.userName,children:[r.userName,n===0&&(0,e.jsx)("span",{className:a.luckyKing,children:"\u{1F451} \u624B\u6C14\u738B"})]}),(0,e.jsx)("div",{className:a.grabTime,children:new Date(r.grabTime||"").toLocaleString()})]}),(0,e.jsxs)("div",{className:a.amount,children:[r.amount," \u79EF\u5206"]})]},r.id)}):(0,e.jsxs)("div",{className:a.emptyRecords,children:[(0,e.jsx)(Ua.Z,{className:a.emptyIcon}),(0,e.jsx)("span",{children:"\u6682\u65E0\u4EBA\u62A2\u5230\u7EA2\u5305"})]})})})}),(0,e.jsx)(ja.Z,{title:"\u70B9\u6B4C",open:al,onCancel:function(){return mn(!1)},footer:null,width:600,children:(0,e.jsx)(mi.Z,{activeKey:ro,onChange:so,items:[{key:"search",label:"\u641C\u7D22\u97F3\u4E50",children:(0,e.jsxs)("div",{className:a.musicSearch,children:[(0,e.jsx)(Ce.Z.Search,{placeholder:"\u8F93\u5165\u6B4C\u66F2\u540D\u79F0",value:vn,onChange:mo,onSearch:ml,enterButton:!0,loading:Pr,style:{marginBottom:"10px"}}),Dr&&(0,e.jsx)(Et.Z,{message:"API\u670D\u52A1\u63D0\u793A",description:Dr,type:"warning",showIcon:!0,style:{marginBottom:"10px"},closable:!0,onClose:function(){return ca(null)}}),Pr?(0,e.jsx)("div",{style:{display:"flex",justifyContent:"center",padding:"40px 0"},children:(0,e.jsx)(he.Z,{tip:"\u6B63\u5728\u641C\u7D22\u97F3\u4E50..."})}):at.length>0?(0,e.jsx)(Mt.t7,{className:a.musicList,height:300,itemCount:at.length,itemSize:60,width:"100%",children:function(n){var t=n.index,s=n.style,m=at[t];return(0,e.jsxs)("div",{style:A()(A()({},s),{},{display:"flex",alignItems:"center",padding:"5px 10px"}),className:a.musicListItem,children:[(0,e.jsxs)("div",{className:a.musicInfo,children:[(0,e.jsx)("div",{className:a.musicTitle,children:m.name}),(0,e.jsx)("div",{className:a.musicDesc,children:"".concat(m.artists.map(function(i){return i.name}).join(",")," - ").concat(m.album.name)})]}),(0,e.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[(0,e.jsx)(I.ZP,{type:"primary",size:"small",onClick:function(){return vl(m)},loading:fn,disabled:fn,children:fn?"\u5904\u7406\u4E2D":"\u53D1\u9001"}),(0,e.jsx)(I.ZP,{size:"small",icon:(0,e.jsx)(Pt.Z,{}),onClick:function(){return lo(m)},loading:Fr===m.id,disabled:Fr!==null,children:"\u6DFB\u52A0\u5230\u6B4C\u5355"})]})]})}}):(0,e.jsx)(sn.Z,{description:Br?"\u672A\u627E\u5230\u76F8\u5173\u6B4C\u66F2":"\u8BF7\u8F93\u5165\u5173\u952E\u8BCD\u5E76\u70B9\u51FB\u641C\u7D22",image:sn.Z.PRESENTED_IMAGE_SIMPLE})]})},{key:"playlist",label:"\u6211\u7684\u6B4C\u5355",children:(0,e.jsxs)("div",{className:a.playlist,children:[(0,e.jsxs)("div",{style:{marginBottom:"10px",display:"flex",justifyContent:"space-between"},children:[(0,e.jsxs)("div",{children:["\u5171 ",Aa.length," \u9996\u6B4C\u66F2"]}),Aa.length>0&&(0,e.jsx)(I.ZP,{type:"primary",size:"small",onClick:uo,children:"\u64AD\u653E\u5168\u90E8"})]}),Aa.length===0?(0,e.jsx)(sn.Z,{description:"\u4F60\u7684\u6B4C\u5355\u8FD8\u662F\u7A7A\u7684",image:sn.Z.PRESENTED_IMAGE_SIMPLE}):(0,e.jsx)("div",{className:a.playlistContainer,style:{maxHeight:"250px",overflow:"auto"},children:Aa.map(function(r){return(0,e.jsxs)("div",{className:a.playlistItem,style:{display:"flex",alignItems:"center",padding:"8px",borderBottom:"1px solid #f0f0f0"},children:[(0,e.jsx)("img",{src:r.cover,alt:r.name,style:{width:"40px",height:"40px",marginRight:"10px",borderRadius:"4px"}}),(0,e.jsxs)("div",{className:a.songInfo,style:{flex:1},children:[(0,e.jsx)("div",{children:r.name}),(0,e.jsx)("div",{style:{fontSize:"12px",color:"#888"},children:r.artist})]}),(0,e.jsxs)("div",{className:a.songActions,children:[(0,e.jsx)(I.ZP,{type:"text",size:"small",icon:(0,e.jsx)(bt.Z,{}),onClick:function(){return oo(r)}}),(0,e.jsx)(I.ZP,{type:"text",size:"small",icon:(0,e.jsx)(rn.Z,{}),onClick:function(){return co(r.id)},danger:!0})]})]},r.id)})}),(0,e.jsx)("div",{ref:en,style:{marginTop:"20px"}})]})}]})}),(0,e.jsx)(ja.Z,{title:"\u7528\u6237\u8BE6\u7EC6\u4FE1\u606F",open:cl,onCancel:function(){return qa(!1)},footer:(c==null?void 0:c.userRole)==="admin"&&(0,e.jsxs)("div",{className:a.userDetailActions,children:[ma!=null&&ma.isMuted?(0,e.jsx)(I.ZP,{type:"primary",onClick:function(){return H&&fo(H.id)},children:"\u89E3\u9664\u7981\u8A00"}):(0,e.jsx)(I.ZP,{type:"primary",danger:!0,onClick:function(){return H&&vo(H.id)},children:"\u7981\u8A00\u7528\u6237"}),(0,e.jsx)(I.ZP,{type:"primary",danger:!0,onClick:function(){return H&&po(H.id)},children:"\u5C01\u7981\u8D26\u53F7"}),(0,e.jsx)(I.ZP,{onClick:function(){return qa(!1)},children:"\u5173\u95ED"})]}),width:400,children:H&&(0,e.jsxs)("div",{className:a.userDetailModal,children:[(0,e.jsxs)("div",{className:a.userDetailHeader,children:[(0,e.jsx)("div",{className:a.avatarWrapper,children:(0,e.jsxs)("div",{className:a.avatarWithFrame,children:[(0,e.jsx)(Sa.Z,{src:H.avatar,size:64}),H.avatarFramerUrl&&(0,e.jsx)("img",{src:H.avatarFramerUrl,className:a.avatarFrame,alt:"avatar-frame"})]})}),(0,e.jsxs)("div",{className:a.userDetailInfo,children:[(0,e.jsx)("div",{className:a.userDetailName,children:H.name}),(0,e.jsxs)("div",{className:a.userDetailId,children:["ID: ",ns(H.id)]}),_n(H.isAdmin,H.level,H.titleId)]})]}),(0,e.jsxs)("div",{className:a.userDetailContent,children:[(0,e.jsxs)("div",{className:a.userDetailItem,children:[(0,e.jsx)("span",{className:a.itemLabel,children:"\u7528\u6237ID\uFF1A"}),(0,e.jsx)("span",{className:a.itemValue,children:H.id})]}),(0,e.jsxs)("div",{className:a.userDetailItem,children:[(0,e.jsx)("span",{className:a.itemLabel,children:"\u7B49\u7EA7\uFF1A"}),(0,e.jsxs)("span",{className:a.itemValue,children:[gn(H.level)," ",H.level]})]}),(0,e.jsxs)("div",{className:a.userDetailItem,children:[(0,e.jsx)("span",{className:a.itemLabel,children:"\u79EF\u5206\uFF1A"}),go?(0,e.jsxs)("div",{className:a.pointsEditContainer,children:[(0,e.jsx)(Ce.Z,{type:"number",value:ot,onChange:function(n){return So(Number(n.target.value))},size:"small",style:{width:100}}),(0,e.jsx)(I.ZP,{type:"primary",size:"small",onClick:jo,children:"\u4FDD\u5B58"}),(0,e.jsx)(I.ZP,{size:"small",onClick:function(){return fs(!1)},style:{marginLeft:4},children:"\u53D6\u6D88"})]}):(0,e.jsx)("div",{className:a.pointsContainer,children:(0,e.jsx)("span",{className:a.itemValue,children:H.points||0})})]}),H.region&&(0,e.jsxs)("div",{className:a.userDetailItem,children:[(0,e.jsx)("span",{className:a.itemLabel,children:"\u5730\u533A\uFF1A"}),(0,e.jsx)("span",{className:a.itemValue,children:H.country?"".concat(H.country," \xB7 ").concat(H.region):H.region})]}),(0,e.jsxs)("div",{className:a.userDetailItem,children:[(0,e.jsx)("span",{className:a.itemLabel,children:"\u7BA1\u7406\u5458\uFF1A"}),(0,e.jsx)("span",{className:a.itemValue,children:H.isAdmin?"\u662F":"\u5426"})]}),(0,e.jsxs)("div",{className:a.userDetailItem,children:[(0,e.jsx)("span",{className:a.itemLabel,children:"\u4E0A\u6B21\u6D3B\u8DC3\uFF1A"}),(0,e.jsx)("span",{className:a.itemValue,children:"\u521A\u521A"})]}),(0,e.jsxs)("div",{className:a.userDetailItem,children:[(0,e.jsx)("span",{className:a.itemLabel,children:"\u72B6\u6001\uFF1A"}),ma!=null&&ma.isMuted?(0,e.jsxs)("span",{className:a.itemValue,style:{color:"#ff4d4f"},children:["\u5DF2\u7981\u8A00\uFF08\u5269\u4F59 ",ma.remainingTime,"\uFF09"]}):(0,e.jsx)("span",{className:a.itemValue,children:H.status||"\u5728\u7EBF"})]})]})]})}),(0,e.jsx)(ja.Z,{title:"\u8BBE\u7F6E\u7981\u8A00\u65F6\u957F",open:yo,onCancel:function(){return jn(!1)},footer:null,width:400,children:(0,e.jsxs)("div",{className:a.muteModalContent,children:[(0,e.jsx)("div",{className:a.muteOptions,children:(0,e.jsxs)(we.ZP.Group,{value:ut,onChange:function(n){_s(n.target.value),ct(void 0)},buttonStyle:"solid",children:[(0,e.jsx)(we.ZP.Button,{value:10,children:"10\u79D2"}),(0,e.jsx)(we.ZP.Button,{value:60,children:"1\u5206\u949F"}),(0,e.jsx)(we.ZP.Button,{value:300,children:"5\u5206\u949F"}),(0,e.jsx)(we.ZP.Button,{value:3600,children:"1\u5C0F\u65F6"}),(0,e.jsx)(we.ZP.Button,{value:86400,children:"1\u5929"})]})}),(0,e.jsx)("div",{className:a.customMuteDuration,style:{marginTop:"16px"},children:(0,e.jsxs)(Ce.Z.Group,{compact:!0,children:[(0,e.jsx)(Ce.Z,{style:{width:"calc(100% - 80px)"},type:"number",placeholder:"\u81EA\u5B9A\u4E49\u7981\u8A00\u65F6\u957F\uFF08\u79D2\uFF09",value:aa,onChange:function(n){return ct(n.target.value?Number(n.target.value):void 0)},min:1}),(0,e.jsx)(I.ZP,{type:"primary",style:{width:"80px"},onClick:function(){aa&&aa>0?_s(aa):C.warning("\u8BF7\u8F93\u5165\u6709\u6548\u7684\u7981\u8A00\u65F6\u957F")},children:"\u786E\u8BA4"})]})}),(0,e.jsxs)("div",{className:a.muteButtons,style:{marginTop:"20px",display:"flex",justifyContent:"flex-end"},children:[(0,e.jsx)(I.ZP,{onClick:function(){return jn(!1)},style:{marginRight:"8px"},children:"\u53D6\u6D88"}),(0,e.jsxs)(I.ZP,{type:"primary",danger:!0,onClick:Po,loading:bo,children:["\u786E\u8BA4\u7981\u8A00 ",ks(aa!==void 0?aa:ut)]})]})]})})]})},fi=vi},7651:function(xn,tn,p){p.d(tn,{o:function(){return Nn}});var In=p(84169),A=p.n(In),bn=p(29957),ee=p.n(bn),wn=p(75204),pe=p.n(wn),Pn=p(98919),f=p(68872),va=p(44737),B=function(){function v(){var ue=this;A()(this,v),pe()(this,"ws",null),pe()(this,"reconnectAttempts",0),pe()(this,"maxReconnectAttempts",5),pe()(this,"reconnectTimeout",null),pe()(this,"messageHandlers",new Map),pe()(this,"isManuallyClosed",!1),pe()(this,"notificationInterval",null),pe()(this,"isWindowFocused",!0),pe()(this,"handleWindowFocus",function(){ue.isWindowFocused=!0,ue.notificationInterval&&((0,va.I0)(ue.notificationInterval),ue.notificationInterval=null)}),pe()(this,"handleWindowBlur",function(){ue.isWindowFocused=!1}),this.addMessageHandler("error",function(l){f.ZP.error(l.data||"\u53D1\u751F\u9519\u8BEF")}),window.addEventListener("focus",this.handleWindowFocus),window.addEventListener("blur",this.handleWindowBlur)}return ee()(v,[{key:"isConnected",value:function(){var l;return((l=this.ws)===null||l===void 0?void 0:l.readyState)===WebSocket.OPEN}},{key:"connect",value:function(l){var Q,z=this;this.isManuallyClosed||((Q=this.ws)===null||Q===void 0?void 0:Q.readyState)!==WebSocket.OPEN&&(this.ws=new WebSocket(Pn.QF+l),this.ws.onopen=function(){var I;if(console.log("WebSocket\u8FDE\u63A5\u6210\u529F"),z.reconnectAttempts=0,((I=z.ws)===null||I===void 0?void 0:I.readyState)===WebSocket.OPEN){var he;(he=z.ws)===null||he===void 0||he.send(JSON.stringify({type:1}))}else f.ZP.error("WebSocket\u8FDE\u63A5\u5931\u8D25")},this.ws.onclose=function(){if(console.log("WebSocket\u8FDE\u63A5\u5173\u95ED"),z.ws=null,!z.isManuallyClosed&&z.reconnectAttempts<z.maxReconnectAttempts){var I=Math.min(1e3*Math.pow(2,z.reconnectAttempts),1e4);z.reconnectTimeout=setTimeout(function(){z.reconnectAttempts++,z.connect(l)},I)}},this.ws.onmessage=function(I){try{var he=JSON.parse(I.data),Ce=z.messageHandlers.get(he.type)||[];if(Ce.forEach(function(pa){return pa(he)}),he.type==="chat"&&!z.isWindowFocused){z.notificationInterval&&(0,va.I0)(z.notificationInterval);var fa=(0,va.pM)(he.data.content||"\u65B0\u6D88\u606F");fa&&(z.notificationInterval=fa)}}catch(pa){console.error("\u5904\u7406WebSocket\u6D88\u606F\u5931\u8D25:",pa)}},this.ws.onerror=function(I){console.error("WebSocket\u9519\u8BEF:",I),f.ZP.error("\u8FDE\u63A5\u53D1\u751F\u9519\u8BEF")},setInterval(function(){var I;((I=z.ws)===null||I===void 0?void 0:I.readyState)===WebSocket.OPEN&&z.ws.send(JSON.stringify({type:4}))},25e3))}},{key:"disconnect",value:function(){this.isManuallyClosed=!0,this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.ws&&(this.ws.close(),this.ws=null),this.notificationInterval&&((0,va.I0)(this.notificationInterval),this.notificationInterval=null),window.removeEventListener("focus",this.handleWindowFocus),window.removeEventListener("blur",this.handleWindowBlur)}},{key:"send",value:function(l){var Q;((Q=this.ws)===null||Q===void 0?void 0:Q.readyState)===WebSocket.OPEN?this.ws.send(JSON.stringify(l)):f.ZP.error("WebSocket\u8FDE\u63A5\u5DF2\u65AD\u5F00")}},{key:"addMessageHandler",value:function(l,Q){var z;this.messageHandlers.has(l)||this.messageHandlers.set(l,[]),(z=this.messageHandlers.get(l))===null||z===void 0||z.push(Q)}},{key:"removeMessageHandler",value:function(l,Q){var z=this.messageHandlers.get(l);if(z){var I=z.indexOf(Q);I!==-1&&z.splice(I,1)}}},{key:"clearMessageHandlers",value:function(){var l=this.messageHandlers.get("error")||[];this.messageHandlers.clear(),this.messageHandlers.set("error",l)}}],[{key:"getInstance",value:function(){return v.instance||(v.instance=new v),v.instance}}]),v}();pe()(B,"instance",void 0);var Nn=B.getInstance()},79614:function(xn){xn.exports=JSON.parse('{"F":[{"id":"-1","name":"\u6478\u9C7C\u76D1\u7763\u5458","description":"\u7CFB\u7EDF\u7BA1\u7406\u5458\u4E13\u5C5E\u79F0\u53F7"},{"id":"0","name":"\u7B49\u7EA7\u79F0\u53F7","description":"\u6839\u636E\u7528\u6237\u7B49\u7EA7\u83B7\u5F97\u7684\u79F0\u53F7"},{"id":"1","name":"\u5929\u4F7F\u6295\u8D44\u4EBA","description":"\u8D5E\u52A9\u4E3B\u64AD 1 \u5757\u4EE5\u4E0A\u83B7\u5F97\u7684\u79F0\u53F7"},{"id":"2","name":"\u9996\u5E2D\u6478\u9C7C\u5B98","description":"\u8D5E\u52A9\u699C\u7B2C\u4E00\u83B7\u5F97\u7684\u79F0\u53F7"},{"id":"3","name":"\u767D\u91D1\u6478\u9C7C\u5B98","description":"\u8D5E\u52A9\u699C\u7B2C\u4E8C\u83B7\u5F97\u7684\u79F0\u53F7"},{"id":"4","name":"\u9EC4\u91D1\u6478\u9C7C\u5B98","description":"\u8D5E\u52A9\u699C\u7B2C\u4E09\u83B7\u5F97\u7684\u79F0\u53F7"},{"id":"5","name":"\u6478\u9C7C\u5171\u5EFA\u8005","description":"\u4EE3\u7801\u8D21\u732E\u8005\u83B7\u5F97\u7684\u79F0\u53F7"}]}')}}]);
